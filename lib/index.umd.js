(function(k,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(k=typeof globalThis<"u"?globalThis:k||self,s(k.ESDrager={},k.Vue))})(this,function(k,s){"use strict";const W={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean}};function $(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function X(o){let n=0,e=0;if(ee(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function ee(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const Y=(o=0)=>parseInt(o+"")+"px",I={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},G=["n","ne","e","se","s","sw","w","nw"],te={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},ne={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},oe=(o,n)=>{const e=ne[Math.floor(o/30)],r=(te[n]+e)%8;return G[r]},O=(o=0,n)=>{let e=[];for(let t=0;t<G.length;t++){const r=G[t],[u,d]=I[r].split("-"),h=oe(o,r),l={[u]:"0%",cursor:h+"-resize",side:I[r]};if(d)l[d]="0%";else{const m=["top","bottom"].includes(u)?"left":"top";l[m]="50%"}n?n.includes(I[r])&&e.push(l):e.push(l)}return e},j=o=>o*Math.PI/180,se=(o,n)=>Math.sqrt(o*o+n*n),y=o=>Math.cos(j(o)),b=o=>Math.sin(j(o)),re=(o,n,e,t,r,u,d)=>{let{width:h,height:l,centerX:m,centerY:v,rotateAngle:c}=n;const g=h<0?-1:1,p=l<0?-1:1;switch(h=Math.abs(h),l=Math.abs(l),o){case"right":{const i=R(h,e,u);h=i.width,e=i.deltaW,r?(t=e/r,l=h/r,m+=e/2*y(c)-t/2*b(c),v+=e/2*b(c)+t/2*y(c)):(m+=e/2*y(c),v+=e/2*b(c));break}case"top-right":{t=-t;const i=R(h,e,u);h=i.width,e=i.deltaW;const a=L(l,t,d);l=a.height,t=a.deltaH,r&&(e=t*r,h=l*r),m+=e/2*y(c)+t/2*b(c),v+=e/2*b(c)-t/2*y(c);break}case"bottom-right":{const i=R(h,e,u);h=i.width,e=i.deltaW;const a=L(l,t,d);l=a.height,t=a.deltaH,r&&(e=t*r,h=l*r),m+=e/2*y(c)-t/2*b(c),v+=e/2*b(c)+t/2*y(c);break}case"bottom":{const i=L(l,t,d);l=i.height,t=i.deltaH,r?(e=t*r,h=l*r,m+=e/2*y(c)-t/2*b(c),v+=e/2*b(c)+t/2*y(c)):(m-=t/2*b(c),v+=t/2*y(c));break}case"bottom-left":{e=-e;const i=R(h,e,u);h=i.width,e=i.deltaW;const a=L(l,t,d);l=a.height,t=a.deltaH,r&&(l=h/r,t=e/r),m-=e/2*y(c)+t/2*b(c),v-=e/2*b(c)-t/2*y(c);break}case"left":{e=-e;const i=R(h,e,u);h=i.width,e=i.deltaW,r?(l=h/r,t=e/r,m-=e/2*y(c)+t/2*b(c),v-=e/2*b(c)-t/2*y(c)):(m-=e/2*y(c),v-=e/2*b(c));break}case"top-left":{e=-e,t=-t;const i=R(h,e,u);h=i.width,e=i.deltaW;const a=L(l,t,d);l=a.height,t=a.deltaH,r&&(h=l*r,e=t*r),m-=e/2*y(c)-t/2*b(c),v-=e/2*b(c)+t/2*y(c);break}case"top":{t=-t;const i=L(l,t,d);l=i.height,t=i.deltaH,r?(h=l*r,e=t*r,m+=e/2*y(c)+t/2*b(c),v+=e/2*b(c)-t/2*y(c)):(m+=t/2*b(c),v-=t/2*y(c));break}}return{position:{centerX:m,centerY:v},size:{width:h*g,height:l*p}}},L=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},R=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},ae=({centerX:o,centerY:n,width:e,height:t,angle:r})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:r}),ce=(o,n,e)=>{const{width:t,height:r}=o;return{width:Math.abs(t),height:Math.abs(r),left:n-Math.abs(t)/2,top:e-Math.abs(r)/2}};function _(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let r=0;return e>n/2?r=t*Math.ceil(Math.abs(o)/n):r=t*Math.floor(Math.abs(o)/n),r}function ie(o,n,e){const t=s.ref(!1),r=s.ref(!1),u=s.ref({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),d=new Set;function h(g){if(d.add(g.button),n.disabled)return;t.value=!0,r.value=!0;let{clientX:p,clientY:i}=X(g);const{left:a,top:f}=u.value;let w=0,E=0;n.boundary&&([w,E]=l()),e&&e("drag-start",u.value),$(D=>{if(d.size>1)return;const{clientX:N,clientY:T}=X(D);let A=(N-p)/n.scaleRatio+a,z=(T-i)/n.scaleRatio+f;if(n.snapToGrid){let{left:x,top:V}=u.value;const B=A-x,K=z-V;A=x+_(B,n.gridX),z=V+_(K,n.gridY)}n.boundary&&([A,z]=m(A,z,w,E)),u.value.left=A,u.value.top=z,e&&e("drag",u.value)},D=>{d.clear(),t.value=!1,document.addEventListener("click",v,{once:!0}),e&&e("drag-end",u.value)})}const l=()=>{const{width:g,height:p}=u.value,a=(o.value.parentElement||document.body).getBoundingClientRect(),f=a.width/n.scaleRatio-g,w=a.height/n.scaleRatio-p;return[f,w]},m=(g,p,i,a)=>(g=g<0?0:g,g=g>i?i:g,p=p<0?0:p,p=p>a?a:p,[g,p]),v=()=>{r.value=!1},c=g=>{if(t.value)return;let{left:p,top:i}=u.value;if(["ArrowRight","ArrowLeft"].includes(g.key)){const a=g.key==="ArrowRight";let f=a?1:-1;n.snapToGrid&&(f=a?n.gridX:-n.gridX),p=p+f}else if(["ArrowUp","ArrowDown"].includes(g.key)){const a=g.key==="ArrowDown";let f=a?1:-1;n.snapToGrid&&(f=a?n.gridY:-n.gridY),i=i+f}if(n.boundary){const[a,f]=l();[p,i]=m(p,i,a,f)}u.value.left=p,u.value.top=i};return s.onMounted(()=>{if(o.value){if(!u.value.width&&!u.value.height){const{width:g,height:p}=o.value.getBoundingClientRect();u.value={...u.value,width:g||100,height:p||100},e("change",{...u.value})}o.value.addEventListener("mousedown",h),o.value.addEventListener("touchstart",h,{passive:!0})}}),s.watch(r,g=>{n.disabledKeyEvent||(g?document.addEventListener("keydown",c):document.removeEventListener("keydown",c))}),s.onBeforeUnmount(()=>{document.removeEventListener("keydown",c)}),{isMousedown:t,selected:r,dragData:u}}const le=s.createElementVNode("div",{class:"es-drager-rotate-handle"},[s.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[s.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),de=s.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=s.ref(null),r=s.computed({get:()=>e.modelValue,set:d=>{n("update:modelValue",d)}});function u(d){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");d.stopPropagation();const{width:h,height:l,left:m,top:v}=e.element.getBoundingClientRect(),c=m+h/2,g=v+l/2;n("rotate-start",r.value),$(p=>{const{clientX:i,clientY:a}=X(p),f=c-i,w=g-a,M=Math.atan2(w,f)*180/Math.PI-90;r.value=(M+360)%360,n("rotate",r.value)},()=>{n("rotate-end",r.value)})}return(d,h)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:u,onTouchstartPassive:u},[s.renderSlot(d.$slots,"default",{},()=>[le])],544))}}),ze="",ue=["data-side","onMousedown","onTouchstartPassive"],he=s.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),S=s.defineComponent({__name:"drager",props:W,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(a,...f)=>{n(a,...f),n("change",...f)},r=s.ref(null),{selected:u,dragData:d,isMousedown:h}=ie(r,e,t),l=s.ref(O(0,e.resizeList)),m=s.computed(()=>e.resizable&&!e.disabled),v=s.computed(()=>e.rotatable&&!e.disabled&&u.value),c=s.computed(()=>{const{width:a,height:f,left:w,top:E,angle:M}=d.value,D={};return a&&(D.width=Y(a)),f&&(D.height=Y(f)),{...D,left:Y(w),top:Y(E),zIndex:e.zIndex,transform:`rotate(${M}deg)`,"--es-drager-color":e.color}});function g(a){r.value||(r.value=a.$el||a)}function p(a){l.value=O(a,e.resizeList),t("rotate-end",d.value)}function i(a,f){f.stopPropagation();const{clientX:w,clientY:E}=X(f),M=w,D=E,{width:N,height:T,left:A,top:z}=d.value,x=A+N/2,V=z+T/2,B={width:N,height:T,centerX:x,centerY:V,rotateAngle:d.value.angle},K=a.side,{minWidth:fe,minHeight:ge,aspectRatio:F,equalProportion:pe}=e;t("resize-start",d.value),$(U=>{const{clientX:me,clientY:we}=X(U);let C=(me-M)/e.scaleRatio,P=(we-D)/e.scaleRatio;e.snapToGrid&&(C=_(C,e.gridX),P=_(P,e.gridY));const ye=Math.atan2(P,C),J=se(C,P),be=U.shiftKey,Q=ye-j(B.rotateAngle),ve=J*Math.cos(Q),Me=J*Math.sin(Q),Ee=(pe||be)&&!F?B.width/B.height:F,{position:{centerX:Z,centerY:H},size:{width:ke,height:De}}=re(K,{...B,rotateAngle:B.rotateAngle},ve,Me,Ee,fe,ge),Ae=ae({centerX:Z,centerY:H,width:ke,height:De,angle:d.value.angle});d.value={...d.value,...ce(Ae,Z,H)},t("resize",d.value)},()=>{t("resize-end",d.value)})}return s.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([a,f,w,E,M])=>{d.value={...d.value,width:a,height:f,left:w,top:E,angle:M}}),s.watch(()=>e.selected,a=>{u.value=a},{immediate:!0}),(a,f)=>(s.openBlock(),s.createBlock(s.resolveDynamicComponent(a.tag),{ref:g,class:s.normalizeClass(["es-drager",{disabled:a.disabled,dragging:s.unref(h),selected:s.unref(u),border:a.border}]),style:s.normalizeStyle(c.value),onClick:f[3]||(f[3]=s.withModifiers(()=>{},["stop"]))},{default:s.withCtx(()=>[s.renderSlot(a.$slots,"default"),m.value?(s.openBlock(!0),s.createElementBlock(s.Fragment,{key:0},s.renderList(l.value,(w,E)=>(s.openBlock(),s.createElementBlock("div",{key:E,class:"es-drager-dot","data-side":w.side,style:s.normalizeStyle({...w}),onMousedown:M=>i(w,M),onTouchstartPassive:M=>i(w,M)},[s.renderSlot(a.$slots,"resize",s.normalizeProps(s.guardReactiveProps({side:w.side})),()=>[he])],44,ue))),128)):s.createCommentVNode("",!0),v.value?(s.openBlock(),s.createBlock(de,{key:1,modelValue:s.unref(d).angle,"onUpdate:modelValue":f[0]||(f[0]=w=>s.unref(d).angle=w),element:r.value,onRotate:f[1]||(f[1]=w=>t("rotate",s.unref(d))),onRotateStart:f[2]||(f[2]=w=>t("rotate-start",s.unref(d))),onRotateEnd:p},{default:s.withCtx(()=>[s.renderSlot(a.$slots,"rotate")]),_:3},8,["modelValue","element"])):s.createCommentVNode("",!0)]),_:3},8,["class","style"]))}}),Be="",q=o=>{o.component("es-drager",S)};S.install=q,k.ESDrager=S,k.default=S,k.install=q,Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
