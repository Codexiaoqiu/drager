(function(g,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(g=typeof globalThis<"u"?globalThis:g||self,n(g.ESDrager={},g.Vue))})(this,function(g,n){"use strict";const T={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number}},B=(r=0)=>parseInt(r+"")+"px",V={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},S=["n","ne","e","se","s","sw","w","nw"],ee={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},te={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},$=(r,c)=>{const e=te[Math.floor(r/30)],o=(ee[c]+e)%8;return S[o]},C=(r=0)=>{let c=[];for(let e=0;e<S.length;e++){const t=S[e],[o,y]=V[t].split("-"),i=$(r,t),l={[o]:"0%",cursor:i+"-resize",side:V[t]};if(y)l[y]="0%";else{const d=["top","bottom"].includes(o)?"left":"top";l[d]="50%"}c[e]=l}return c},N=r=>r*Math.PI/180,F=(r,c)=>Math.sqrt(r*r+c*c),p=r=>Math.cos(N(r)),m=r=>Math.sin(N(r)),j=(r,c,e,t,o,y,i)=>{let{width:l,height:d,centerX:b,centerY:w,rotateAngle:s}=c;const f=l<0?-1:1,u=d<0?-1:1;switch(l=Math.abs(l),d=Math.abs(d),r){case"right":{const a=A(l,e,y);l=a.width,e=a.deltaW,o?(t=e/o,d=l/o,b+=e/2*p(s)-t/2*m(s),w+=e/2*m(s)+t/2*p(s)):(b+=e/2*p(s),w+=e/2*m(s));break}case"top-right":{t=-t;const a=A(l,e,y);l=a.width,e=a.deltaW;const h=z(d,t,i);d=h.height,t=h.deltaH,o&&(e=t*o,l=d*o),b+=e/2*p(s)+t/2*m(s),w+=e/2*m(s)-t/2*p(s);break}case"bottom-right":{const a=A(l,e,y);l=a.width,e=a.deltaW;const h=z(d,t,i);d=h.height,t=h.deltaH,o&&(e=t*o,l=d*o),b+=e/2*p(s)-t/2*m(s),w+=e/2*m(s)+t/2*p(s);break}case"bottom":{const a=z(d,t,i);d=a.height,t=a.deltaH,o?(e=t*o,l=d*o,b+=e/2*p(s)-t/2*m(s),w+=e/2*m(s)+t/2*p(s)):(b-=t/2*m(s),w+=t/2*p(s));break}case"bottom-left":{e=-e;const a=A(l,e,y);l=a.width,e=a.deltaW;const h=z(d,t,i);d=h.height,t=h.deltaH,o&&(d=l/o,t=e/o),b-=e/2*p(s)+t/2*m(s),w-=e/2*m(s)-t/2*p(s);break}case"left":{e=-e;const a=A(l,e,y);l=a.width,e=a.deltaW,o?(d=l/o,t=e/o,b-=e/2*p(s)+t/2*m(s),w-=e/2*m(s)-t/2*p(s)):(b-=e/2*p(s),w-=e/2*m(s));break}case"top-left":{e=-e,t=-t;const a=A(l,e,y);l=a.width,e=a.deltaW;const h=z(d,t,i);d=h.height,t=h.deltaH,o&&(l=d*o,e=t*o),b-=e/2*p(s)-t/2*m(s),w-=e/2*m(s)+t/2*p(s);break}case"top":{t=-t;const a=z(d,t,i);d=a.height,t=a.deltaH,o?(l=d*o,e=t*o,b+=e/2*p(s)+t/2*m(s),w+=e/2*m(s)-t/2*p(s)):(b+=t/2*m(s),w-=t/2*p(s));break}}return{position:{centerX:b,centerY:w},size:{width:l*f,height:d*u}}},z=(r,c,e)=>{const t=r+c;return t>e?r=t:(c=e-r,r=e),{height:r,deltaH:c}},A=(r,c,e)=>{const t=r+c;return t>e?r=t:(c=e-r,r=e),{width:r,deltaW:c}},q=({centerX:r,centerY:c,width:e,height:t,angle:o})=>({top:c-t/2,left:r-e/2,width:e,height:t,angle:o}),O=(r,c,e)=>{const{width:t,height:o}=r;return{width:Math.abs(t),height:Math.abs(o),left:c-Math.abs(t)/2,top:e-Math.abs(o)/2}};let ne=1e3;function oe(r,c,e){const t=n.ref(),o=n.ref(!1),y=n.ref(!1),i=n.ref({width:c.width,height:c.height,left:c.left,top:c.top,angle:c.angle});function l(b){if(c.disabled)return;o.value=!0,y.value=!0;const w=r.value;let{clientX:s,clientY:f}=b;const{width:u,height:a,left:h,top:D}=i.value;w.style.zIndex=se();let E=0,X=0,L=0,Y=0;if(c.boundary){const M=(w.parentElement||document.body).getBoundingClientRect();X=M.width-u,Y=M.height-a}const P=s-h,_=f-D;e&&e("drag-start",i.value),I(v=>{let M=v.clientX-P,k=v.clientY-_;c.boundary&&(M=M<E?E:M,M=M>X?X:M,k=k<L?L:k,k=k>Y?Y:k),i.value.left=M,i.value.top=k,e&&e("drag",i.value)},v=>{o.value=!1,document.addEventListener("click",d,{once:!0}),e&&e("drag-end",i.value)})}const d=()=>{y.value=!1};return n.onMounted(()=>{r.value&&r.value.addEventListener("mousedown",l)}),{isMousedown:o,selected:y,dragRef:t,dragData:i}}function se(){return++ne+""}function I(r,c){const e=t=>{c&&c(t),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",e)}const re=n.createElementVNode("div",{class:"es-drager-rotate-handle"},[n.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[n.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),ae=n.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(r,{emit:c}){const e=r,t=n.ref(null),o=n.computed({get:()=>e.modelValue,set:i=>{c("update:modelValue",i)}});function y(i){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");i.stopPropagation(),i.preventDefault();const{width:l,height:d,left:b,top:w}=e.element.getBoundingClientRect(),s=b+l/2,f=w+d/2;c("rotate-start",o.value),I(u=>{const a=s-u.clientX,h=f-u.clientY,E=Math.atan2(h,a)*180/Math.PI-90;o.value=(E+360)%360,c("rotate",o.value)},()=>{c("rotate-end",o.value)})}return(i,l)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:y},[n.renderSlot(i.$slots,"default",{},()=>[re])],544))}}),Me="",ce={key:0},ie=["data-side","onMousedown"],le=n.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),R=n.defineComponent({__name:"drager",props:T,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(r,{emit:c}){const e=r,t=(f,...u)=>{c(f,...u),c("change",...u)},o=n.ref(null),{selected:y,dragData:i,isMousedown:l}=oe(o,e,t),d=n.ref(C()),b=n.computed(()=>{const{width:f,height:u,left:a,top:h,angle:D}=i.value;return{width:B(f),height:B(u),left:B(a),top:B(h),transform:`rotate(${D}deg)`,"--es-drager-color":e.color}});function w(f){d.value=C(f),t("rotate-end",i.value)}function s(f,u){u.stopPropagation(),u.preventDefault();const a=u.clientX,h=u.clientY,{width:D,height:E,left:X,top:L}=i.value,Y=X+D/2,P=L+E/2,_={width:D,height:E,centerX:Y,centerY:P,rotateAngle:i.value.angle},K=f.side,{minWidth:v,minHeight:M,aspectRatio:k}=e;t("resize-start",i.value),I(Z=>{const{clientX:de,clientY:ue}=Z,G=de-a,J=ue-h,fe=Math.atan2(J,G),Q=F(G,J),he=Z.shiftKey,x=fe-N(_.rotateAngle),ge=Q*Math.cos(x),pe=Q*Math.sin(x),me=he&&!k?_.width/_.height:k,{position:{centerX:H,centerY:W},size:{width:we,height:be}}=j(K,{..._,rotateAngle:_.rotateAngle},ge,pe,me,v,M),ye=q({centerX:H,centerY:W,width:we,height:be,angle:i.value.angle});i.value={...i.value,...O(ye,H,W)},t("resize",i.value)},()=>{t("resize-end",i.value)})}return n.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([f,u,a,h,D])=>{i.value={...i.value,width:f,height:u,left:a,top:h,angle:D}}),(f,u)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"dragRef",ref:o,class:n.normalizeClass(["es-drager",{disabled:f.disabled,dragging:n.unref(l)}]),style:n.normalizeStyle(n.unref(b)),onClick:u[3]||(u[3]=n.withModifiers(()=>{},["stop"]))},[n.renderSlot(f.$slots,"default"),!f.disabled&&f.resizable?n.withDirectives((n.openBlock(),n.createElementBlock("div",ce,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(d.value,(a,h)=>(n.openBlock(),n.createElementBlock("div",{key:h,class:"es-drager-dot","data-side":a.side,style:n.normalizeStyle({...a}),onMousedown:D=>s(a,D)},[n.renderSlot(f.$slots,"resize",n.normalizeProps(n.guardReactiveProps({side:a.side})),()=>[le])],44,ie))),128))],512)),[[n.vShow,n.unref(y)]]):n.createCommentVNode("",!0),!f.disabled&&n.unref(y)?(n.openBlock(),n.createBlock(ae,{key:1,modelValue:n.unref(i).angle,"onUpdate:modelValue":u[0]||(u[0]=a=>n.unref(i).angle=a),"drag-data":n.unref(i),element:o.value,onRotate:u[1]||(u[1]=a=>t("rotate",n.unref(i))),onRotateStart:u[2]||(u[2]=a=>t("rotate-start",n.unref(i))),onRotateEnd:w},{default:n.withCtx(()=>[n.renderSlot(f.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):n.createCommentVNode("",!0)],6))}}),De="",U=r=>{r.component("es-drager",R)};R.install=U,g.DragerProps=T,g.ESDrager=R,g.centerToTL=q,g.cursorDirectionArray=S,g.default=R,g.degToRadian=N,g.formatData=O,g.getCursor=$,g.getDotList=C,g.getLength=F,g.getNewStyle=j,g.install=U,g.resizableMap=V,g.withUnit=B,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
