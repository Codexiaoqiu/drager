(function(D,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(D=typeof globalThis<"u"?globalThis:D||self,s(D.ESDrager={},D.Vue))})(this,function(D,s){"use strict";const te={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean}};function $(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function _(o){let n=0,e=0;if(ne(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function ne(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const N=(o=0)=>parseInt(o+"")+"px",I={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},G=["n","ne","e","se","s","sw","w","nw"],oe={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},se={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},re=(o,n)=>{const e=se[Math.floor(o/30)],r=(oe[n]+e)%8;return G[r]},F=(o=0,n)=>{let e=[];for(let t=0;t<G.length;t++){const r=G[t],[h,d]=I[r].split("-"),f=re(o,r),l={[h]:"0%",cursor:f+"-resize",side:I[r]};if(d)l[d]="0%";else{const w=["top","bottom"].includes(h)?"left":"top";l[w]="50%"}n?n.includes(I[r])&&e.push(l):e.push(l)}return e},j=o=>o*Math.PI/180,ae=(o,n)=>Math.sqrt(o*o+n*n),y=o=>Math.cos(j(o)),b=o=>Math.sin(j(o)),ce=(o,n,e,t,r,h,d)=>{let{width:f,height:l,centerX:w,centerY:v,rotateAngle:c}=n;const g=f<0?-1:1,m=l<0?-1:1;switch(f=Math.abs(f),l=Math.abs(l),o){case"right":{const i=L(f,e,h);f=i.width,e=i.deltaW,r?(t=e/r,l=f/r,w+=e/2*y(c)-t/2*b(c),v+=e/2*b(c)+t/2*y(c)):(w+=e/2*y(c),v+=e/2*b(c));break}case"top-right":{t=-t;const i=L(f,e,h);f=i.width,e=i.deltaW;const a=z(l,t,d);l=a.height,t=a.deltaH,r&&(e=t*r,f=l*r),w+=e/2*y(c)+t/2*b(c),v+=e/2*b(c)-t/2*y(c);break}case"bottom-right":{const i=L(f,e,h);f=i.width,e=i.deltaW;const a=z(l,t,d);l=a.height,t=a.deltaH,r&&(e=t*r,f=l*r),w+=e/2*y(c)-t/2*b(c),v+=e/2*b(c)+t/2*y(c);break}case"bottom":{const i=z(l,t,d);l=i.height,t=i.deltaH,r?(e=t*r,f=l*r,w+=e/2*y(c)-t/2*b(c),v+=e/2*b(c)+t/2*y(c)):(w-=t/2*b(c),v+=t/2*y(c));break}case"bottom-left":{e=-e;const i=L(f,e,h);f=i.width,e=i.deltaW;const a=z(l,t,d);l=a.height,t=a.deltaH,r&&(l=f/r,t=e/r),w-=e/2*y(c)+t/2*b(c),v-=e/2*b(c)-t/2*y(c);break}case"left":{e=-e;const i=L(f,e,h);f=i.width,e=i.deltaW,r?(l=f/r,t=e/r,w-=e/2*y(c)+t/2*b(c),v-=e/2*b(c)-t/2*y(c)):(w-=e/2*y(c),v-=e/2*b(c));break}case"top-left":{e=-e,t=-t;const i=L(f,e,h);f=i.width,e=i.deltaW;const a=z(l,t,d);l=a.height,t=a.deltaH,r&&(f=l*r,e=t*r),w-=e/2*y(c)-t/2*b(c),v-=e/2*b(c)+t/2*y(c);break}case"top":{t=-t;const i=z(l,t,d);l=i.height,t=i.deltaH,r?(f=l*r,e=t*r,w+=e/2*y(c)+t/2*b(c),v+=e/2*b(c)-t/2*y(c)):(w+=t/2*b(c),v-=t/2*y(c));break}}return{position:{centerX:w,centerY:v},size:{width:f*g,height:l*m}}},z=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},L=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},ie=({centerX:o,centerY:n,width:e,height:t,angle:r})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:r}),le=(o,n,e)=>{const{width:t,height:r}=o;return{width:Math.abs(t),height:Math.abs(r),left:n-Math.abs(t)/2,top:e-Math.abs(r)/2}};function T(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let r=0;return e>n/2?r=t*Math.ceil(Math.abs(o)/n):r=t*Math.floor(Math.abs(o)/n),r}function de(o,n,e){const t=s.ref(!1),r=s.ref(!1),h=s.ref({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),d=new Set;function f(g){if(d.add(g.button),n.disabled)return;t.value=!0,r.value=!0;let{clientX:m,clientY:i}=_(g);const{left:a,top:u}=h.value;let p=0,M=0,E=0,k=0;n.boundary&&([p,M,E,k]=l()),e&&e("drag-start",h.value),$(B=>{if(d.size>1)return;const{clientX:R,clientY:K}=_(B);let X=(R-m)/n.scaleRatio+a,Y=(K-i)/n.scaleRatio+u;if(n.snapToGrid){let{left:A,top:C}=h.value;const O=X-A,q=Y-C;X=A+T(O,n.gridX),Y=C+T(q,n.gridY)}n.boundary&&([X,Y]=w(X,Y,p,M,E,k)),h.value.left=X,h.value.top=Y,e&&e("drag",h.value)},B=>{d.clear(),t.value=!1,document.addEventListener("click",v,{once:!0}),e&&e("drag-end",h.value)})}const l=()=>{let g=0,m=0;const{left:i,top:a,height:u,width:p,angle:M}=h.value,k=(o.value.parentElement||document.body).getBoundingClientRect();if(M){const R=o.value.getBoundingClientRect();g=Math.abs(R.left-(i+k.left)),m=Math.abs(R.top-(a+k.top))}const S=k.width/n.scaleRatio-p,B=k.height/n.scaleRatio-u;return[g,S-g,m,B-m]},w=(g,m,i,a,u,p)=>(g=g<i?i:g,g=g>a?a:g,m=m<u?u:m,m=m>p?p:m,[g,m]),v=()=>{r.value=!1},c=g=>{if(t.value)return;let{left:m,top:i}=h.value;if(["ArrowRight","ArrowLeft"].includes(g.key)){const a=g.key==="ArrowRight";let u=a?1:-1;n.snapToGrid&&(u=a?n.gridX:-n.gridX),m=m+u}else if(["ArrowUp","ArrowDown"].includes(g.key)){const a=g.key==="ArrowDown";let u=a?1:-1;n.snapToGrid&&(u=a?n.gridY:-n.gridY),i=i+u}if(n.boundary){const[a,u,p,M]=l();[m,i]=w(m,i,a,u,p,M)}h.value.left=m,h.value.top=i};return s.onMounted(()=>{if(o.value){if(!h.value.width&&!h.value.height){const{width:g,height:m}=o.value.getBoundingClientRect();h.value={...h.value,width:g||100,height:m||100},e("change",{...h.value})}o.value.addEventListener("mousedown",f),o.value.addEventListener("touchstart",f,{passive:!0})}}),s.watch(r,g=>{n.disabledKeyEvent||(g?document.addEventListener("keydown",c):document.removeEventListener("keydown",c))}),s.onBeforeUnmount(()=>{document.removeEventListener("keydown",c)}),{isMousedown:t,selected:r,dragData:h}}const ue=s.createElementVNode("div",{class:"es-drager-rotate-handle"},[s.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[s.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),he=s.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=s.ref(null),r=s.computed({get:()=>e.modelValue,set:d=>{n("update:modelValue",d)}});function h(d){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");d.stopPropagation();const{width:f,height:l,left:w,top:v}=e.element.getBoundingClientRect(),c=w+f/2,g=v+l/2;n("rotate-start",r.value),$(m=>{const{clientX:i,clientY:a}=_(m),u=c-i,p=g-a,E=Math.atan2(p,u)*180/Math.PI-90;r.value=(E+360)%360,n("rotate",r.value)},()=>{n("rotate-end",r.value)})}return(d,f)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:h,onTouchstartPassive:h},[s.renderSlot(d.$slots,"default",{},()=>[ue])],544))}}),Be="",fe=["data-side","onMousedown","onTouchstartPassive"],ge=s.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),x=s.defineComponent({__name:"drager",props:te,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(a,...u)=>{n(a,...u),n("change",...u)},r=s.ref(null),{selected:h,dragData:d,isMousedown:f}=de(r,e,t),l=s.ref(F(0,e.resizeList)),w=s.computed(()=>e.resizable&&!e.disabled),v=s.computed(()=>e.rotatable&&!e.disabled&&h.value),c=s.computed(()=>{const{width:a,height:u,left:p,top:M,angle:E}=d.value,k={};return a&&(k.width=N(a)),u&&(k.height=N(u)),{...k,left:N(p),top:N(M),zIndex:e.zIndex,transform:`rotate(${E}deg)`,"--es-drager-color":e.color}});function g(a){r.value||(r.value=a.$el||a)}function m(a){l.value=F(a,e.resizeList),t("rotate-end",d.value)}function i(a,u){u.stopPropagation();const{clientX:p,clientY:M}=_(u),E=p,k=M,{width:S,height:B,left:R,top:K}=d.value,X=R+S/2,Y=K+B/2,A={width:S,height:B,centerX:X,centerY:Y,rotateAngle:d.value.angle},C=a.side,{minWidth:O,minHeight:q,aspectRatio:J,equalProportion:me}=e;t("resize-start",d.value),$(Q=>{const{clientX:pe,clientY:we}=_(Q);let V=(pe-E)/e.scaleRatio,P=(we-k)/e.scaleRatio;e.snapToGrid&&(V=T(V,e.gridX),P=T(P,e.gridY));const ye=Math.atan2(P,V),Z=ae(V,P),be=Q.shiftKey,H=ye-j(A.rotateAngle),ve=Z*Math.cos(H),Me=Z*Math.sin(H),Ee=(me||be)&&!J?A.width/A.height:J,{position:{centerX:W,centerY:ee},size:{width:ke,height:De}}=ce(C,{...A,rotateAngle:A.rotateAngle},ve,Me,Ee,O,q),Ae=ie({centerX:W,centerY:ee,width:ke,height:De,angle:d.value.angle});d.value={...d.value,...le(Ae,W,ee)},t("resize",d.value)},()=>{t("resize-end",d.value)})}return s.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([a,u,p,M,E])=>{d.value={...d.value,width:a,height:u,left:p,top:M,angle:E}}),s.watch(()=>e.selected,a=>{h.value=a},{immediate:!0}),(a,u)=>(s.openBlock(),s.createBlock(s.resolveDynamicComponent(a.tag),{ref:g,class:s.normalizeClass(["es-drager",{disabled:a.disabled,dragging:s.unref(f),selected:s.unref(h),border:a.border}]),style:s.normalizeStyle(c.value),onClick:u[3]||(u[3]=s.withModifiers(()=>{},["stop"]))},{default:s.withCtx(()=>[s.renderSlot(a.$slots,"default"),w.value?(s.openBlock(!0),s.createElementBlock(s.Fragment,{key:0},s.renderList(l.value,(p,M)=>(s.openBlock(),s.createElementBlock("div",{key:M,class:"es-drager-dot","data-side":p.side,style:s.normalizeStyle({...p}),onMousedown:E=>i(p,E),onTouchstartPassive:E=>i(p,E)},[s.renderSlot(a.$slots,"resize",s.normalizeProps(s.guardReactiveProps({side:p.side})),()=>[ge])],44,fe))),128)):s.createCommentVNode("",!0),v.value?(s.openBlock(),s.createBlock(he,{key:1,modelValue:s.unref(d).angle,"onUpdate:modelValue":u[0]||(u[0]=p=>s.unref(d).angle=p),element:r.value,onRotate:u[1]||(u[1]=p=>t("rotate",s.unref(d))),onRotateStart:u[2]||(u[2]=p=>t("rotate-start",s.unref(d))),onRotateEnd:m},{default:s.withCtx(()=>[s.renderSlot(a.$slots,"rotate")]),_:3},8,["modelValue","element"])):s.createCommentVNode("",!0)]),_:3},8,["class","style"]))}}),Xe="",U=o=>{o.component("es-drager",x)};x.install=U,D.ESDrager=x,D.default=x,D.install=U,Object.defineProperties(D,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
