(function(g,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(g=typeof globalThis<"u"?globalThis:g||self,e(g.ESDrager={},g.Vue))})(this,function(g,e){"use strict";const R={zoomable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:[Number,String],default:100},height:{type:[Number,String],default:100},left:{type:[Number,String],default:0},top:{type:[Number,String],default:0},color:{type:String,default:"#3a7afe"}},k=Symbol("DragContextKey"),X=[{side:"top",cursor:"n-resize"},{side:"bottom",cursor:"n-resize"},{side:"left",cursor:"e-resize"},{side:"right",cursor:"e-resize"},{side:"top-left",cursor:"se-resize"},{side:"top-right",cursor:"sw-resize"},{side:"bottom-left",cursor:"sw-resize"},{side:"bottom-right",cursor:"se-resize"}];function C(t){const[o,s]=t.side.split("-"),l={[o]:"0%",cursor:t.cursor};if(s)l[s]="0%";else{const d=["top","bottom"].includes(o)?"left":"top";l[d]="50%"}return l}const B=(t=0)=>parseInt(t+"")+"px";let P=1e3;function I(t,o,s){const l=e.ref(),d=e.ref(!1),a=e.ref(!1),p=e.ref({width:o.width,height:o.height,left:o.left,top:o.top});function h(r){if(o.disabled)return;d.value=!0,a.value=!0;const i=t.value,u=r.clientX,w=r.clientY,y=i.getBoundingClientRect();i.style.zIndex=x();let n=0,c=0,v=0,_=0;if(o.boundary){const f=(i.parentElement||document.body).getBoundingClientRect();n=f.left,c=f.left+f.width-y.width,v=f.top,_=f.top+f.height-y.height}const z=u-y.left,D=w-y.top;M(E=>{let f=E.clientX-z,b=E.clientY-D;o.boundary&&(f=f<n?n:f,f=f>c?c:f,b=b<v?v:b,b=b>_?_:b),p.value.left=f,p.value.top=b,s&&s("move",p.value)},E=>{d.value=!1,document.addEventListener("click",m,{once:!0})})}const m=()=>{a.value=!1};return e.onMounted(()=>{t.value&&t.value.addEventListener("mousedown",h)}),{isMousedown:d,selected:a,dragRef:l,dragData:p}}function x(){return++P+""}function M(t,o){const s=l=>{o&&o(l),document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",s)}const V=Object.keys(R).reduce((t,o)=>(t[o]=R[o].default,t),{});function T(t){for(let o=0;o<X.length;o++){const s=document.createElement("div");s.className="es-drager-dot";const l=C(X[o]);Object.keys(l).forEach(d=>{s.style[d]=l[d]}),s.setAttribute("data-side",X[o].side),t.appendChild(s),s.addEventListener("mousedown",d=>{j(X[o],d,t)})}}function j(t,o,s){o.stopPropagation(),o.preventDefault();const l=o.clientX,d=o.clientY,a=s.getBoundingClientRect();M(h=>{const m=h.clientX-l,r=h.clientY-d,[i,u]=t.side.split("-"),w=i==="top",y=[i,u].includes("left");let n=a.width+(y?-m:m),c=a.height+(w?-r:r),v=a.left+(y?m:0),_=a.top+(w?r:0);u||(["top","bottom"].includes(i)?n=a.width:c=a.height),n<0&&(n=-n,v-=n),c<0&&(c=-c,_-=c),s.style.width=`${n}px`,s.style.height=`${c}px`,s.style.left=`${v}px`,s.style.top=`${_}px`})}const O={mounted(t,o){const s={...V,...o.value||{}};t.classList.add("es-drager"),t.onmousedown=l=>{const d=l.clientX,a=l.clientY,p=t.getBoundingClientRect();t.style.zIndex=x();let h=0,m=0,r=0,i=0;if(s.boundary){const n=(t.parentElement||document.body).getBoundingClientRect();h=n.left,m=n.left+n.width-p.width,r=n.top,i=n.top+n.height-p.height}const u=d-p.left,w=a-p.top;M(y=>{let n=y.clientX-u,c=y.clientY-w;s.boundary&&(n=n<h?h:n,n=n>m?m:n,c=c<r?r:c,c=c>i?i:c),t.style.left=n+"px",t.style.top=c+"px"})},s.zoomable&&T(t)},unmounted(t){t.onmousedown=null}},K=[e.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})],-1)],A=e.defineComponent({__name:"rotate",props:{visible:Boolean},emits:["rotate"],setup(t,{emit:o}){const{dragRef:s}=e.inject(k)||{},l=e.ref(null),d=e.ref(0);function a(p){if(p.stopPropagation(),p.preventDefault(),!s||!s.value)return console.error("[es-drager] rotate need dragRef");const h=s.value,m=h.getBoundingClientRect(),r=m.left+m.width/2,i=m.top+m.height/2;M(u=>{const w=r-u.clientX,y=i-u.clientY,n=Math.atan2(y,w);d.value=n*180/Math.PI-90,o("rotate",d.value),h.style.transform=`rotate(${d.value}deg)`})}return(p,h)=>t.visible?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"rotateRef",ref:l,class:"es-drager-rotate",onMousedown:a},K,544)):e.createCommentVNode("",!0)}}),Z="",U={key:0},q=["data-side","onMousedown"],L=e.defineComponent({__name:"drager",props:R,emits:["move","resize"],setup(t,{emit:o}){const s=t,l=e.ref(null),{selected:d,dragData:a,isMousedown:p}=I(l,s,o);e.provide(k,{dragRef:l});const h=e.computed(()=>{const{width:r,height:i,left:u,top:w}=a.value;return{width:B(r),height:B(i),left:B(u),top:B(w),"--es-drager-color":s.color}});function m(r,i){i.stopPropagation(),i.preventDefault();const u=i.clientX,w=i.clientY,n=l.value.getBoundingClientRect();M(v=>{const _=v.clientX-u,z=v.clientY-w,[D,S]=r.side.split("-"),E=D==="top",f=[D,S].includes("left");let b=n.width+(f?-_:_),Y=n.height+(E?-z:z),N=n.left+(f?_:0),$=n.top+(E?z:0);S||(["top","bottom"].includes(D)?b=n.width:Y=n.height),b<0&&(b=-b,N-=b),Y<0&&(Y=-Y,$-=Y),a.value={left:N,top:$,width:b,height:Y},o("resize",a.value)})}return(r,i)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"dragRef",ref:l,class:e.normalizeClass(["es-drager",{disabled:r.disabled,dragging:e.unref(p)}]),style:e.normalizeStyle(e.unref(h)),onClick:i[0]||(i[0]=e.withModifiers(()=>{},["stop"]))},[e.renderSlot(r.$slots,"default"),!r.disabled&&r.zoomable?e.withDirectives((e.openBlock(),e.createElementBlock("div",U,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(X),u=>(e.openBlock(),e.createElementBlock("div",{key:u.side,class:"es-drager-dot","data-side":u.side,style:e.normalizeStyle(e.unref(C)(u)),onMousedown:w=>m(u,w)},null,44,q))),128))],512)),[[e.vShow,e.unref(d)]]):e.createCommentVNode("",!0),e.createVNode(A,{visible:!r.disabled&&e.unref(d)},null,8,["visible"])],6))}}),G="",F=t=>{t.component("es-drager",L)};g.DragContextKey=k,g.Drager=O,g.DragerProps=R,g.default=L,g.dotList=X,g.getDotStyle=C,g.install=F,g.withUnit=B,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
