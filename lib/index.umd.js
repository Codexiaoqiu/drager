(function(Y,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],i):(Y=typeof globalThis<"u"?globalThis:Y||self,i(Y.ESDrager={},Y.Vue))})(this,function(Y,i){"use strict";const J={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean},snap:Boolean,snapThreshold:{type:Number,default:10},markline:[Boolean,Function]};function K(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function _(o){let n=0,e=0;if(ae(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function ae(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const P=(o=0)=>parseInt(o+"")+"px",F={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},j=["n","ne","e","se","s","sw","w","nw"],ce={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},ue={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},de=(o,n)=>{const e=ue[Math.floor(o/30)],l=(ce[n]+e)%8;return j[l]},Q=(o=0,n)=>{let e=[];for(let t=0;t<j.length;t++){const l=j[t],[g,s]=F[l].split("-"),u=de(o,l),d={[g]:"0%",cursor:u+"-resize",side:F[l]};if(s)d[s]="0%";else{const p=["top","bottom"].includes(g)?"left":"top";d[p]="50%"}n?n.includes(F[l])&&e.push(d):e.push(d)}return e},O=o=>o*Math.PI/180,fe=(o,n)=>Math.sqrt(o*o+n*n),M=o=>Math.cos(O(o)),L=o=>Math.sin(O(o)),he=(o,n,e,t,l,g,s)=>{let{width:u,height:d,centerX:p,centerY:y,rotateAngle:a}=n;const x=u<0?-1:1,f=d<0?-1:1;switch(u=Math.abs(u),d=Math.abs(d),o){case"right":{const r=N(u,e,g);u=r.width,e=r.deltaW,l?(t=e/l,d=u/l,p+=e/2*M(a)-t/2*L(a),y+=e/2*L(a)+t/2*M(a)):(p+=e/2*M(a),y+=e/2*L(a));break}case"top-right":{t=-t;const r=N(u,e,g);u=r.width,e=r.deltaW;const h=S(d,t,s);d=h.height,t=h.deltaH,l&&(e=t*l,u=d*l),p+=e/2*M(a)+t/2*L(a),y+=e/2*L(a)-t/2*M(a);break}case"bottom-right":{const r=N(u,e,g);u=r.width,e=r.deltaW;const h=S(d,t,s);d=h.height,t=h.deltaH,l&&(e=t*l,u=d*l),p+=e/2*M(a)-t/2*L(a),y+=e/2*L(a)+t/2*M(a);break}case"bottom":{const r=S(d,t,s);d=r.height,t=r.deltaH,l?(e=t*l,u=d*l,p+=e/2*M(a)-t/2*L(a),y+=e/2*L(a)+t/2*M(a)):(p-=t/2*L(a),y+=t/2*M(a));break}case"bottom-left":{e=-e;const r=N(u,e,g);u=r.width,e=r.deltaW;const h=S(d,t,s);d=h.height,t=h.deltaH,l&&(d=u/l,t=e/l),p-=e/2*M(a)+t/2*L(a),y-=e/2*L(a)-t/2*M(a);break}case"left":{e=-e;const r=N(u,e,g);u=r.width,e=r.deltaW,l?(d=u/l,t=e/l,p-=e/2*M(a)+t/2*L(a),y-=e/2*L(a)-t/2*M(a)):(p-=e/2*M(a),y-=e/2*L(a));break}case"top-left":{e=-e,t=-t;const r=N(u,e,g);u=r.width,e=r.deltaW;const h=S(d,t,s);d=h.height,t=h.deltaH,l&&(u=d*l,e=t*l),p-=e/2*M(a)-t/2*L(a),y-=e/2*L(a)+t/2*M(a);break}case"top":{t=-t;const r=S(d,t,s);d=r.height,t=r.deltaH,l?(u=d*l,e=t*l,p+=e/2*M(a)+t/2*L(a),y+=e/2*L(a)-t/2*M(a)):(p+=t/2*L(a),y-=t/2*M(a));break}}return{position:{centerX:p,centerY:y},size:{width:u*x,height:d*f}}},S=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},N=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},ge=({centerX:o,centerY:n,width:e,height:t,angle:l})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:l}),pe=(o,n,e)=>{const{width:t,height:l}=o;return{width:Math.abs(t),height:Math.abs(l),left:n-Math.abs(t)/2,top:e-Math.abs(l)/2}};function V(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let l=0;return e>n/2?l=t*Math.ceil(Math.abs(o)/n):l=t*Math.floor(Math.abs(o)/n),l}function me(o,n){if(!o||!n)return!1;const e=o.getBoundingClientRect(),t=n.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}const Z=o=>typeof o=="function";function ye(o,n){let e=null,t=null;const l=i.computed(()=>o.value.offsetParent||document.body),g=i.computed(()=>l.value.getBoundingClientRect()),s=i.ref({x:[],y:[]}),u=()=>{n.markline&&!Z(n.markline)&&(e||(e=document.querySelector(".es-drager-markline-x")||H("x",l.value,n.color)),t||(t=document.querySelector(".es-drager-markline-y")||H("y",l.value,n.color)))},d=(f={})=>{if(n.markline){if(Z(n.markline))return n.markline(f);f.left===null?e.style.display="none":(e.style.left=f.left+"px",e.style.backgroundColor=n.color,e.style.display="block"),f.top===null?t.style.display="none":(t.style.top=f.top+"px",t.style.backgroundColor=n.color,t.style.display="block")}},p=()=>{const f=o.value.getBoundingClientRect(),r=document.querySelectorAll(".es-drager"),h=[];for(let w=0;w<r.length;w++){const v=r[w];v!==o.value&&h.push(v.getBoundingClientRect())}s.value=we(h,f)},y=()=>{const f={top:null,left:null,diffX:0,diffY:0},r=o.value.getBoundingClientRect();for(let h=0;h<s.value.y.length;h++){const{top:w,showTop:v}=s.value.y[h];if(Math.abs(w-r.top)<n.snapThreshold){f.diffY=w-r.top,f.top=v-g.value.top;break}}for(let h=0;h<s.value.x.length;h++){const{left:w,showLeft:v}=s.value.x[h];if(Math.abs(w-r.left)<n.snapThreshold){f.diffX=w-r.left,f.left=v-g.value.left;break}}return d(f),f},a=()=>{d({left:null,top:null})},x=f=>{if(!(!n.snap&&!n.markline))switch(f){case"drag-start":p();break;case"drag":return y();case"drag-end":a();break}};return i.onMounted(()=>{u()}),{marklineEmit:x}}function H(o="x",n,e=""){const t=document.createElement("div");return t.classList.add(`es-drager-markline-${o}`),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="9999",t.style.backgroundColor=e,t.style.display="none",o==="x"?(t.style.height="100%",t.style.width="1px"):(t.style.height="1px",t.style.width="100%"),n.appendChild(t),t}function we(o,n){const e={x:[],y:[]},{width:t=0,height:l=0}=n;return o.forEach(g=>{const{top:s,left:u,width:d,height:p}=g;e.y.push({showTop:s,top:s}),e.y.push({showTop:s,top:s-l}),e.y.push({showTop:s+p/2,top:s+p/2-l/2}),e.y.push({showTop:s+p,top:s+p}),e.y.push({showTop:s+p,top:s+p-l}),e.x.push({showLeft:u,left:u}),e.x.push({showLeft:u+d,left:u+d}),e.x.push({showLeft:u+d/2,left:u+d/2-t/2}),e.x.push({showLeft:u+d,left:u+d-t}),e.x.push({showLeft:u,left:u-t})}),e}function be(o,n,e,{getBoundary:t,fixBoundary:l,checkDragerCollision:g,emit:s}){let u=0,d=0;const p=a=>{let{left:x,top:f}=n.value;if(u||(u=x),d||(d=f),["ArrowRight","ArrowLeft"].includes(a.key)){const r=a.key==="ArrowRight";let h=r?1:-1;o.snapToGrid&&(h=r?o.gridX:-o.gridX),x=x+h}else if(["ArrowUp","ArrowDown"].includes(a.key)){const r=a.key==="ArrowDown";let h=r?1:-1;o.snapToGrid&&(h=r?o.gridY:-o.gridY),f=f+h}if(o.boundary){const[r,h,w,v]=t();[x,f]=l(x,f,r,h,w,v)}n.value.left=x,n.value.top=f},y=a=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(a.key)&&o.checkCollision&&g()&&(n.value.left=u,n.value.top=d),u=0,d=0};i.watch(e,a=>{o.disabledKeyEvent||(a?(document.addEventListener("keydown",p),document.addEventListener("keyup",y)):(document.removeEventListener("keydown",p),document.removeEventListener("keyup",y)))}),i.onBeforeUnmount(()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",y)})}function ve(o,n,e){const t=i.ref(!1),l=i.ref(!1),g=i.ref({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),{marklineEmit:s}=ye(o,n),u=new Set;function d(f){if(u.add(f.button),n.disabled)return;t.value=!0,l.value=!0;let{clientX:r,clientY:h}=_(f);const{left:w,top:v}=g.value;let c=0,m=0,b=0,k=0;n.boundary&&([c,m,b,k]=p()),s("drag-start"),e&&e("drag-start",g.value),K(E=>{if(u.size>1)return;const{clientX:X,clientY:C}=_(E);let B=(X-r)/n.scaleRatio+w,R=(C-h)/n.scaleRatio+v;if(n.snapToGrid){let{left:T,top:$}=g.value;const z=B-T,U=R-$;B=T+V(z,n.gridX),R=$+V(U,n.gridY)}n.boundary&&([B,R]=y(B,R,c,m,b,k)),g.value.left=B,g.value.top=R,e&&e("drag",g.value),i.nextTick(()=>{const T=s("drag");n.snap&&(T.diffX&&(g.value.left+=T.diffX),T.diffY&&(g.value.top+=T.diffY))})},E=>{n.checkCollision&&a()&&(g.value.top=v,g.value.left=w),u.clear(),t.value=!1,document.addEventListener("click",x,{once:!0}),s("drag-end"),e&&e("drag-end",g.value)})}const p=()=>{let f=0,r=0;const{left:h,top:w,height:v,width:c,angle:m}=g.value,k=(o.value.offsetParent||document.body).getBoundingClientRect();if(m&&n.scaleRatio===1){const X=o.value.getBoundingClientRect();f=Math.abs(X.left-(h+k.left)),r=Math.abs(X.top-(w+k.top))}const A=k.width/n.scaleRatio-c,E=k.height/n.scaleRatio-v;return[f,A-f,r,E-r,k.width/n.scaleRatio,k.height/n.scaleRatio]},y=(f,r,h,w,v,c)=>(f=f<h?h:f,f=f>w?w:f,r=r<v?v:r,r=r>c?c:r,[f,r]),a=()=>{const f=o.value.offsetParent||document.body,r=Array.from(f.children).filter(h=>h!==o.value&&h.classList.contains("es-drager"));for(let h=0;h<r.length;h++){const w=r[h];if(me(o.value,w))return!0}},x=()=>{l.value=!1};return be(n,g,l,{getBoundary:p,fixBoundary:y,checkDragerCollision:a,emit:e}),i.onMounted(()=>{if(o.value){if(!g.value.width&&!g.value.height){const{width:f,height:r}=o.value.getBoundingClientRect();g.value={...g.value,width:f||100,height:r||100}}o.value.addEventListener("mousedown",d),o.value.addEventListener("touchstart",d,{passive:!0})}}),{isMousedown:t,selected:l,dragData:g,getBoundary:p,checkDragerCollision:a}}const ke=i.createElementVNode("div",{class:"es-drager-rotate-handle"},[i.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[i.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Me=i.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=i.ref(null),l=i.computed({get:()=>e.modelValue,set:s=>{n("update:modelValue",s)}});function g(s){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");s.stopPropagation();const{width:u,height:d,left:p,top:y}=e.element.getBoundingClientRect(),a=p+u/2,x=y+d/2;n("rotate-start",l.value),K(f=>{const{clientX:r,clientY:h}=_(f),w=a-r,v=x-h,m=Math.atan2(v,w)*180/Math.PI-90;l.value=(m+360)%360,n("rotate",l.value)},()=>{n("rotate-end",l.value)})}return(s,u)=>(i.openBlock(),i.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:g,onTouchstartPassive:g},[i.renderSlot(s.$slots,"default",{},()=>[ke])],544))}}),_e="",Le=["data-side","onMousedown","onTouchstartPassive"],xe=i.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),I=i.defineComponent({__name:"drager",props:J,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(c,...m)=>{n(c,...m)},l=i.ref(null),{selected:g,dragData:s,isMousedown:u,getBoundary:d,checkDragerCollision:p}=ve(l,e,t),y=i.ref(Q(0,e.resizeList)),a=i.computed(()=>e.resizable&&!e.disabled),x=i.computed(()=>e.rotatable&&!e.disabled&&g.value),f=i.computed(()=>{const{width:c,height:m,left:b,top:k,angle:A}=s.value,E={};return c&&(E.width=P(c)),m&&(E.height=P(m)),{...E,left:P(b),top:P(k),zIndex:e.zIndex,transform:`rotate(${A}deg)`,"--es-drager-color":e.color}});function r(c){l.value||(l.value=c.$el||c)}function h(c){y.value=Q(c,e.resizeList),t("rotate-end",s.value)}function w(c,m){if(e.disabled)return;m.stopPropagation();const{clientX:b,clientY:k}=_(m),A=b,E=k,{width:X,height:C,left:B,top:R}=s.value,T=B+X/2,$=R+C/2,z={width:X,height:C,centerX:T,centerY:$,rotateAngle:s.value.angle},U=c.side,{minWidth:Ee,minHeight:Ae,aspectRatio:ee,equalProportion:Be}=e;t("resize-start",s.value);let te=[];e.boundary&&(te=d()),K(ne=>{const{clientX:Xe,clientY:Ye}=_(ne);let q=(Xe-A)/e.scaleRatio,G=(Ye-E)/e.scaleRatio;e.snapToGrid&&(q=V(q,e.gridX),G=V(G,e.gridY));const Ce=Math.atan2(G,q),oe=fe(q,G),Re=ne.shiftKey,se=Ce-O(z.rotateAngle),Te=oe*Math.cos(se),ze=oe*Math.sin(se),le=(Be||Re)&&!ee?z.width/z.height:ee,{position:{centerX:ie,centerY:re},size:{width:De,height:Se}}=he(U,{...z,rotateAngle:z.rotateAngle},Te,ze,le,Ee,Ae),Ne=ge({centerX:ie,centerY:re,width:De,height:Se,angle:s.value.angle});let D={...s.value,...pe(Ne,ie,re)};e.maxWidth>0&&(D.width=Math.min(D.width,e.maxWidth)),e.maxHeight>0&&(D.height=Math.min(D.height,e.maxHeight)),e.boundary&&(D=v(D,te,le)),s.value=D,t("resize",s.value)},()=>{e.checkCollision&&p()&&(s.value={...s.value,width:X,height:C,left:B,top:R}),t("resize-end",s.value)})}function v(c,m,b){const[k,A,E,X,C,B]=m;return c.left<k&&(c.left=k,c.width=s.value.width,b&&(c.height=s.value.height)),c.left+c.width>C&&(c.left=s.value.left,c.width=C-c.left,b&&(c.height=s.value.height)),c.top<E&&(c.top=E,c.height=s.value.height,b&&(c.width=s.value.width)),c.top+c.height>B&&(c.top=s.value.top,c.height=B-c.top,b&&(c.width=s.value.width)),c}return i.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([c,m,b,k,A],[E,X,C,B,R])=>{c!==E&&(s.value.width=c),m!==X&&(s.value.height=m),b!==C&&(s.value.left=b),k!==B&&(s.value.top=k),A!==R&&(s.value.angle=A)}),i.watch(()=>s.value,c=>{n("change",{...c})},{deep:!0}),i.watch(()=>e.selected,c=>{g.value=c},{immediate:!0}),(c,m)=>(i.openBlock(),i.createBlock(i.resolveDynamicComponent(c.tag),{ref:r,class:i.normalizeClass(["es-drager",{disabled:c.disabled,dragging:i.unref(u),selected:i.unref(g),border:c.border}]),style:i.normalizeStyle(f.value),onClick:m[3]||(m[3]=i.withModifiers(()=>{},["stop"]))},{default:i.withCtx(()=>[i.renderSlot(c.$slots,"default"),a.value?(i.openBlock(!0),i.createElementBlock(i.Fragment,{key:0},i.renderList(y.value,(b,k)=>(i.openBlock(),i.createElementBlock("div",{key:k,class:"es-drager-dot","data-side":b.side,style:i.normalizeStyle({...b}),onMousedown:A=>w(b,A),onTouchstartPassive:A=>w(b,A)},[i.renderSlot(c.$slots,"resize",i.normalizeProps(i.guardReactiveProps({side:b.side})),()=>[xe])],44,Le))),128)):i.createCommentVNode("",!0),x.value?(i.openBlock(),i.createBlock(Me,{key:1,modelValue:i.unref(s).angle,"onUpdate:modelValue":m[0]||(m[0]=b=>i.unref(s).angle=b),element:l.value,onRotate:m[1]||(m[1]=b=>t("rotate",i.unref(s))),onRotateStart:m[2]||(m[2]=b=>t("rotate-start",i.unref(s))),onRotateEnd:h},{default:i.withCtx(()=>[i.renderSlot(c.$slots,"rotate")]),_:3},8,["modelValue","element"])):i.createCommentVNode("",!0)]),_:3},8,["class","style"]))}}),Pe="",W=o=>{o.component("es-drager",I)};I.install=W,Y.DragerProps=J,Y.ESDrager=I,Y.default=I,Y.install=W,Object.defineProperties(Y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
