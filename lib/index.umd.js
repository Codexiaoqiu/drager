(function(h,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(h=typeof globalThis<"u"?globalThis:h||self,n(h.ESDrager={},h.Vue))})(this,function(h,n){"use strict";const U={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50}},_=(s=0)=>parseInt(s+"")+"px",P={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},R=["n","ne","e","se","s","sw","w","nw"],se={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},re={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},K=(s,r)=>{const e=re[Math.floor(s/30)],a=(se[r]+e)%8;return R[a]},$=(s=0)=>{let r=[];for(let e=0;e<R.length;e++){const t=R[e],[a,w]=P[t].split("-"),l=K(s,t),i={[a]:"0%",cursor:l+"-resize",side:P[t]};if(w)i[w]="0%";else{const d=["top","bottom"].includes(a)?"left":"top";i[d]="50%"}r[e]=i}return r},S=s=>s*Math.PI/180,Z=(s,r)=>Math.sqrt(s*s+r*r),g=s=>Math.cos(S(s)),p=s=>Math.sin(S(s)),J=(s,r,e,t,a,w,l)=>{let{width:i,height:d,centerX:b,centerY:m,rotateAngle:c}=r;const X=i<0?-1:1,f=d<0?-1:1;switch(i=Math.abs(i),d=Math.abs(d),s){case"right":{const o=v(i,e,w);i=o.width,e=o.deltaW,a?(t=e/a,d=i/a,b+=e/2*g(c)-t/2*p(c),m+=e/2*p(c)+t/2*g(c)):(b+=e/2*g(c),m+=e/2*p(c));break}case"top-right":{t=-t;const o=v(i,e,w);i=o.width,e=o.deltaW;const u=Y(d,t,l);d=u.height,t=u.deltaH,a&&(e=t*a,i=d*a),b+=e/2*g(c)+t/2*p(c),m+=e/2*p(c)-t/2*g(c);break}case"bottom-right":{const o=v(i,e,w);i=o.width,e=o.deltaW;const u=Y(d,t,l);d=u.height,t=u.deltaH,a&&(e=t*a,i=d*a),b+=e/2*g(c)-t/2*p(c),m+=e/2*p(c)+t/2*g(c);break}case"bottom":{const o=Y(d,t,l);d=o.height,t=o.deltaH,a?(e=t*a,i=d*a,b+=e/2*g(c)-t/2*p(c),m+=e/2*p(c)+t/2*g(c)):(b-=t/2*p(c),m+=t/2*g(c));break}case"bottom-left":{e=-e;const o=v(i,e,w);i=o.width,e=o.deltaW;const u=Y(d,t,l);d=u.height,t=u.deltaH,a&&(d=i/a,t=e/a),b-=e/2*g(c)+t/2*p(c),m-=e/2*p(c)-t/2*g(c);break}case"left":{e=-e;const o=v(i,e,w);i=o.width,e=o.deltaW,a?(d=i/a,t=e/a,b-=e/2*g(c)+t/2*p(c),m-=e/2*p(c)-t/2*g(c)):(b-=e/2*g(c),m-=e/2*p(c));break}case"top-left":{e=-e,t=-t;const o=v(i,e,w);i=o.width,e=o.deltaW;const u=Y(d,t,l);d=u.height,t=u.deltaH,a&&(i=d*a,e=t*a),b-=e/2*g(c)-t/2*p(c),m-=e/2*p(c)+t/2*g(c);break}case"top":{t=-t;const o=Y(d,t,l);d=o.height,t=o.deltaH,a?(i=d*a,e=t*a,b+=e/2*g(c)+t/2*p(c),m+=e/2*p(c)-t/2*g(c)):(b+=t/2*p(c),m-=t/2*g(c));break}}return{position:{centerX:b,centerY:m},size:{width:i*X,height:d*f}}},Y=(s,r,e)=>{const t=s+r;return t>e?s=t:(r=e-s,s=e),{height:s,deltaH:r}},v=(s,r,e)=>{const t=s+r;return t>e?s=t:(r=e-s,s=e),{width:s,deltaW:r}},Q=({centerX:s,centerY:r,width:e,height:t,angle:a})=>({top:r-t/2,left:s-e/2,width:e,height:t,angle:a}),x=(s,r,e)=>{const{width:t,height:a}=s;return{width:Math.abs(t),height:Math.abs(a),left:r-Math.abs(t)/2,top:e-Math.abs(a)/2}};let ae=1e3;function ce(s,r,e){const t=n.ref(),a=n.ref(!1),w=n.ref(!1),l=n.ref({width:r.width,height:r.height,left:r.left,top:r.top,angle:r.angle});function i(b){if(r.disabled)return;a.value=!0,w.value=!0;const m=s.value;let{clientX:c,clientY:X}=b;const{width:f,height:o,left:u,top:D}=l.value;m.style.zIndex=le();let y=0,z=0,V=0,B=0;if(r.boundary){const M=(m.parentElement||document.body).getBoundingClientRect();z=M.width-f,B=M.height-o}const F=c-u,j=X-D;e&&e("drag-start",l.value),G(E=>{let M=E.clientX-F,k=E.clientY-j;if(r.snapToGrid){let{left:N,top:q}=l.value;const T=M-N,O=k-q;M=H(T,r.gridX,N),k=H(O,r.gridY,q)}r.boundary&&(M=M<y?y:M,M=M>z?z:M,k=k<V?V:k,k=k>B?B:k),l.value.left=M,l.value.top=k,e&&e("drag",l.value)},E=>{a.value=!1,document.addEventListener("click",d,{once:!0}),e&&e("drag-end",l.value)})}const d=()=>{w.value=!1};return n.onMounted(()=>{s.value&&s.value.addEventListener("mousedown",i)}),{isMousedown:a,selected:w,dragRef:t,dragData:l}}function le(){return++ae+""}function G(s,r){const e=t=>{r&&r(t),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",e)}function H(s,r,e){let t=e;return Math.abs(s)>r/2&&(t=e+(s>0?r:-r)),t}const ie=n.createElementVNode("div",{class:"es-drager-rotate-handle"},[n.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[n.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),de=n.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(s,{emit:r}){const e=s,t=n.ref(null),a=n.computed({get:()=>e.modelValue,set:l=>{r("update:modelValue",l)}});function w(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation(),l.preventDefault();const{width:i,height:d,left:b,top:m}=e.element.getBoundingClientRect(),c=b+i/2,X=m+d/2;r("rotate-start",a.value),G(f=>{const o=c-f.clientX,u=X-f.clientY,y=Math.atan2(u,o)*180/Math.PI-90;a.value=(y+360)%360,r("rotate",a.value)},()=>{r("rotate-end",a.value)})}return(l,i)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:w},[n.renderSlot(l.$slots,"default",{},()=>[ie])],544))}}),ke="",ue=["data-side","onMousedown"],fe=n.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),L=n.defineComponent({__name:"drager",props:U,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(s,{emit:r}){const e=s,t=(f,...o)=>{r(f,...o),r("change",...o)},a=n.ref(null),{selected:w,dragData:l,isMousedown:i}=ce(a,e,t),d=n.ref($()),b=n.computed(()=>{const{width:f,height:o,left:u,top:D,angle:y}=l.value;return{width:_(f),height:_(o),left:_(u),top:_(D),transform:`rotate(${y}deg)`,"--es-drager-color":e.color}});function m(f){d.value=$(f),t("rotate-end",l.value)}function c(f,o){const u=Math.abs(f)%o,D=f>0?o:-o;let y=0;return u>o/2?y=D*Math.ceil(Math.abs(f)/o):y=D*Math.floor(Math.abs(f)/o),y}function X(f,o){o.stopPropagation(),o.preventDefault();const u=o.clientX,D=o.clientY,{width:y,height:z,left:V,top:B}=l.value,F=V+y/2,j=B+z/2,A={width:y,height:z,centerX:F,centerY:j,rotateAngle:l.value.angle},E=f.side,{minWidth:M,minHeight:k,aspectRatio:N}=e;t("resize-start",l.value),G(T=>{const{clientX:O,clientY:he}=T;let C=O-u,I=he-D;e.snapToGrid&&(C=c(C,e.gridX),I=c(I,e.gridY));const ge=Math.atan2(I,C),ee=Z(C,I),pe=T.shiftKey,te=ge-S(A.rotateAngle),me=ee*Math.cos(te),we=ee*Math.sin(te),be=pe&&!N?A.width/A.height:N,{position:{centerX:ne,centerY:oe},size:{width:ye,height:Me}}=J(E,{...A,rotateAngle:A.rotateAngle},me,we,be,M,k),De=Q({centerX:ne,centerY:oe,width:ye,height:Me,angle:l.value.angle});l.value={...l.value,...x(De,ne,oe)},t("resize",l.value)},()=>{t("resize-end",l.value)})}return n.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([f,o,u,D,y])=>{l.value={...l.value,width:f,height:o,left:u,top:D,angle:y}}),n.watch(()=>e.selected,f=>{w.value=f},{immediate:!0}),(f,o)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"dragRef",ref:a,class:n.normalizeClass(["es-drager",{disabled:f.disabled,dragging:n.unref(i),selected:n.unref(w)}]),style:n.normalizeStyle(n.unref(b)),onClick:o[3]||(o[3]=n.withModifiers(()=>{},["self","stop"]))},[n.renderSlot(f.$slots,"default"),!f.disabled&&f.resizable?(n.openBlock(!0),n.createElementBlock(n.Fragment,{key:0},n.renderList(d.value,(u,D)=>(n.openBlock(),n.createElementBlock("div",{key:D,class:"es-drager-dot","data-side":u.side,style:n.normalizeStyle({...u}),onMousedown:y=>X(u,y)},[n.renderSlot(f.$slots,"resize",n.normalizeProps(n.guardReactiveProps({side:u.side})),()=>[fe])],44,ue))),128)):n.createCommentVNode("",!0),!f.disabled&&n.unref(w)?(n.openBlock(),n.createBlock(de,{key:1,modelValue:n.unref(l).angle,"onUpdate:modelValue":o[0]||(o[0]=u=>n.unref(l).angle=u),"drag-data":n.unref(l),element:a.value,onRotate:o[1]||(o[1]=u=>t("rotate",n.unref(l))),onRotateStart:o[2]||(o[2]=u=>t("rotate-start",n.unref(l))),onRotateEnd:m},{default:n.withCtx(()=>[n.renderSlot(f.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):n.createCommentVNode("",!0)],6))}}),Xe="",W=s=>{s.component("es-drager",L)};L.install=W,h.DragerProps=U,h.ESDrager=L,h.centerToTL=Q,h.cursorDirectionArray=R,h.default=L,h.degToRadian=S,h.formatData=x,h.getCursor=K,h.getDotList=$,h.getLength=Z,h.getNewStyle=J,h.install=W,h.resizableMap=P,h.withUnit=_,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
