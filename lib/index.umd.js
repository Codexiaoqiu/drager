(function(b,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(b=typeof globalThis<"u"?globalThis:b||self,n(b.ESDrager={},b.Vue))})(this,function(b,n){"use strict";const R={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number}},_=(o=0)=>parseInt(o+"")+"px",C={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},N=["n","ne","e","se","s","sw","w","nw"],ee={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},te={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},$=(o,c)=>{const e=te[Math.floor(o/30)],r=(ee[c]+e)%8;return N[r]},I=(o=0)=>{let c=[];for(let e=0;e<N.length;e++){const t=N[e],[r,y]=C[t].split("-"),l=$(o,t),i={[r]:"0%",cursor:l+"-resize",side:C[t]};if(y)i[y]="0%";else{const d=["top","bottom"].includes(r)?"left":"top";i[d]="50%"}c[e]=i}return c},S=o=>o*Math.PI/180,x=(o,c)=>Math.sqrt(o*o+c*c),m=o=>Math.cos(S(o)),w=o=>Math.sin(S(o)),F=(o,c,e,t,r,y,l)=>{let{width:i,height:d,centerX:p,centerY:g,rotateAngle:a}=c;const h=i<0?-1:1,u=d<0?-1:1;switch(i=Math.abs(i),d=Math.abs(d),o){case"right":{const s=v(i,e,y);i=s.width,e=s.deltaW,r?(t=e/r,d=i/r,p+=e/2*m(a)-t/2*w(a),g+=e/2*w(a)+t/2*m(a)):(p+=e/2*m(a),g+=e/2*w(a));break}case"top-right":{t=-t;const s=v(i,e,y);i=s.width,e=s.deltaW;const f=Y(d,t,l);d=f.height,t=f.deltaH,r&&(e=t*r,i=d*r),p+=e/2*m(a)+t/2*w(a),g+=e/2*w(a)-t/2*m(a);break}case"bottom-right":{const s=v(i,e,y);i=s.width,e=s.deltaW;const f=Y(d,t,l);d=f.height,t=f.deltaH,r&&(e=t*r,i=d*r),p+=e/2*m(a)-t/2*w(a),g+=e/2*w(a)+t/2*m(a);break}case"bottom":{const s=Y(d,t,l);d=s.height,t=s.deltaH,r?(e=t*r,i=d*r,p+=e/2*m(a)-t/2*w(a),g+=e/2*w(a)+t/2*m(a)):(p-=t/2*w(a),g+=t/2*m(a));break}case"bottom-left":{e=-e;const s=v(i,e,y);i=s.width,e=s.deltaW;const f=Y(d,t,l);d=f.height,t=f.deltaH,r&&(d=i/r,t=e/r),p-=e/2*m(a)+t/2*w(a),g-=e/2*w(a)-t/2*m(a);break}case"left":{e=-e;const s=v(i,e,y);i=s.width,e=s.deltaW,r?(d=i/r,t=e/r,p-=e/2*m(a)+t/2*w(a),g-=e/2*w(a)-t/2*m(a)):(p-=e/2*m(a),g-=e/2*w(a));break}case"top-left":{e=-e,t=-t;const s=v(i,e,y);i=s.width,e=s.deltaW;const f=Y(d,t,l);d=f.height,t=f.deltaH,r&&(i=d*r,e=t*r),p-=e/2*m(a)-t/2*w(a),g-=e/2*w(a)+t/2*m(a);break}case"top":{t=-t;const s=Y(d,t,l);d=s.height,t=s.deltaH,r?(i=d*r,e=t*r,p+=e/2*m(a)+t/2*w(a),g+=e/2*w(a)-t/2*m(a)):(p+=t/2*w(a),g-=t/2*m(a));break}}return{position:{centerX:p,centerY:g},size:{width:i*h,height:d*u}}},Y=(o,c,e)=>{const t=o+c;return t>e?o=t:(c=e-o,o=e),{height:o,deltaH:c}},v=(o,c,e)=>{const t=o+c;return t>e?o=t:(c=e-o,o=e),{width:o,deltaW:c}},O=({centerX:o,centerY:c,width:e,height:t,angle:r})=>({top:c-t/2,left:o-e/2,width:e,height:t,angle:r}),j=(o,c,e)=>{const{width:t,height:r}=o;return{width:Math.abs(t),height:Math.abs(r),left:c-Math.abs(t)/2,top:e-Math.abs(r)/2}};let ne=1e3;function oe(o,c,e){const t=n.ref(),r=n.ref(!1),y=n.ref(!1),l=n.ref({width:c.width,height:c.height,left:c.left,top:c.top,angle:c.angle});function i(p){if(c.disabled)return;r.value=!0,y.value=!0;const g=o.value;let{clientX:a,clientY:h}=p;const{width:u,height:s,left:f,top:D}=l.value;g.style.zIndex=q();let E=0,A=0,V=0,B=0;if(c.boundary){const M=(g.parentElement||document.body).getBoundingClientRect();A=M.width-u,B=M.height-s}const T=a-f,X=h-D;e&&e("drag-start",l.value),L(z=>{let M=z.clientX-T,k=z.clientY-X;c.boundary&&(M=M<E?E:M,M=M>A?A:M,k=k<V?V:k,k=k>B?B:k),l.value.left=M,l.value.top=k,e&&e("drag",l.value)},z=>{r.value=!1,document.addEventListener("click",d,{once:!0}),e&&e("drag-end",l.value)})}const d=()=>{y.value=!1};return n.onMounted(()=>{o.value&&o.value.addEventListener("mousedown",i)}),{isMousedown:r,selected:y,dragRef:t,dragData:l}}function q(){return++ne+""}function L(o,c){const e=t=>{c&&c(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e)}const se=Object.keys(R).reduce((o,c)=>(o[c]=R[c].default,o),{}),re={mounted(o,c){const e={...se,...c.value||{}};o.classList.add("es-drager"),o.onmousedown=t=>{const r=t.clientX,y=t.clientY,l=o.getBoundingClientRect();o.style.zIndex=q();let i=0,d=0,p=0,g=0;if(e.boundary){const s=(o.parentElement||document.body).getBoundingClientRect();i=s.left,d=s.left+s.width-l.width,p=s.top,g=s.top+s.height-l.height}const a=r-l.left,h=y-l.top;L(u=>{let s=u.clientX-a,f=u.clientY-h;e.boundary&&(s=s<i?i:s,s=s>d?d:s,f=f<p?p:f,f=f>g?g:f),o.style.left=s+"px",o.style.top=f+"px"})}},unmounted(o){o.onmousedown=null}},ae=n.createElementVNode("div",{class:"es-drager-rotate-handle"},[n.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[n.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),ce=n.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:c}){const e=o,t=n.ref(null),r=n.computed({get:()=>e.modelValue,set:l=>{c("update:modelValue",l)}});function y(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation(),l.preventDefault();const{width:i,height:d,left:p,top:g}=e.element.getBoundingClientRect(),a=p+i/2,h=g+d/2;c("rotate-start",r.value),L(u=>{const s=a-u.clientX,f=h-u.clientY,E=Math.atan2(f,s)*180/Math.PI-90;r.value=(E+360)%360,c("rotate",r.value)},()=>{c("rotate-end",r.value)})}return(l,i)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:y},[n.renderSlot(l.$slots,"default",{},()=>[ae])],544))}}),De="",le={key:0},ie=["data-side","onMousedown"],de=n.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),P=n.defineComponent({__name:"drager",props:R,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:c}){const e=o,t=(h,...u)=>{c(h,...u),c("change",...u)},r=n.ref(null),{selected:y,dragData:l,isMousedown:i}=oe(r,e,t),d=n.ref(I()),p=n.computed(()=>{const{width:h,height:u,left:s,top:f,angle:D}=l.value;return{width:_(h),height:_(u),left:_(s),top:_(f),transform:`rotate(${D}deg)`,"--es-drager-color":e.color}});function g(h){d.value=I(h),t("rotate-end",l.value)}function a(h,u){u.stopPropagation(),u.preventDefault();const s=u.clientX,f=u.clientY,{width:D,height:E,left:A,top:V}=l.value,B=A+D/2,T=V+E/2,X={width:D,height:E,centerX:B,centerY:T,rotateAngle:l.value.angle},U=h.side,{minWidth:z,minHeight:M,aspectRatio:k}=e;t("resize-start",l.value),L(K=>{const{clientX:ue,clientY:fe}=K,Z=ue-s,G=fe-f,he=Math.atan2(G,Z),J=x(Z,G),ge=K.shiftKey,Q=he-S(X.rotateAngle),pe=J*Math.cos(Q),me=J*Math.sin(Q),we=ge&&!k?X.width/X.height:k,{position:{centerX:H,centerY:W},size:{width:ye,height:be}}=F(U,{...X,rotateAngle:X.rotateAngle},pe,me,we,z,M),Me=O({centerX:H,centerY:W,width:ye,height:be,angle:l.value.angle});l.value={...l.value,...j(Me,H,W)},t("resize",l.value)},()=>{t("resize-end",l.value)})}return n.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([h,u,s,f,D])=>{l.value={...l.value,width:h,height:u,left:s,top:f,angle:D}}),(h,u)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"dragRef",ref:r,class:n.normalizeClass(["es-drager",{disabled:h.disabled,dragging:n.unref(i)}]),style:n.normalizeStyle(n.unref(p)),onClick:u[3]||(u[3]=n.withModifiers(()=>{},["stop"]))},[n.renderSlot(h.$slots,"default"),!h.disabled&&h.resizable?n.withDirectives((n.openBlock(),n.createElementBlock("div",le,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(d.value,(s,f)=>(n.openBlock(),n.createElementBlock("div",{key:f,class:"es-drager-dot","data-side":s.side,style:n.normalizeStyle({...s}),onMousedown:D=>a(s,D)},[n.renderSlot(h.$slots,"resize",n.normalizeProps(n.guardReactiveProps({side:s.side})),()=>[de])],44,ie))),128))],512)),[[n.vShow,n.unref(y)]]):n.createCommentVNode("",!0),!h.disabled&&n.unref(y)?(n.openBlock(),n.createBlock(ce,{key:1,modelValue:n.unref(l).angle,"onUpdate:modelValue":u[0]||(u[0]=s=>n.unref(l).angle=s),"drag-data":n.unref(l),element:r.value,onRotate:u[1]||(u[1]=s=>t("rotate",n.unref(l))),onRotateStart:u[2]||(u[2]=s=>t("rotate-start",n.unref(l))),onRotateEnd:g},{default:n.withCtx(()=>[n.renderSlot(h.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):n.createCommentVNode("",!0)],6))}}),ke="";P.install=o=>{o.component("es-drager",P)},b.Drager=re,b.DragerProps=R,b.centerToTL=O,b.cursorDirectionArray=N,b.default=P,b.degToRadian=S,b.formatData=j,b.getCursor=$,b.getDotList=I,b.getLength=x,b.getNewStyle=F,b.resizableMap=C,b.withUnit=_,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
