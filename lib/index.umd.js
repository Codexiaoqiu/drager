(function(b,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(b=typeof globalThis<"u"?globalThis:b||self,s(b.ESDrager={},b.Vue))})(this,function(b,s){"use strict";const R={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number}},A=(n=0)=>parseInt(n+"")+"px",V={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},L=["n","ne","e","se","s","sw","w","nw"],ee={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},te={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},$=(n,a)=>{const e=te[Math.floor(n/30)],r=(ee[a]+e)%8;return L[r]},I=(n=0)=>{let a=[];for(let e=0;e<L.length;e++){const t=L[e],[r,y]=V[t].split("-"),i=$(n,t),l={[r]:"0%",cursor:i+"-resize",side:V[t]};if(y)l[y]="0%";else{const d=["top","bottom"].includes(r)?"left":"top";l[d]="50%"}a[e]=l}return a},N=n=>n*Math.PI/180,x=(n,a)=>Math.sqrt(n*n+a*a),m=n=>Math.cos(N(n)),w=n=>Math.sin(N(n)),F=(n,a,e,t,r,y,i)=>{let{width:l,height:d,centerX:g,centerY:h,rotateAngle:c}=a;const p=l<0?-1:1,u=d<0?-1:1;switch(l=Math.abs(l),d=Math.abs(d),n){case"right":{const o=Y(l,e,y);l=o.width,e=o.deltaW,r?(t=e/r,d=l/r,g+=e/2*m(c)-t/2*w(c),h+=e/2*w(c)+t/2*m(c)):(g+=e/2*m(c),h+=e/2*w(c));break}case"top-right":{t=-t;const o=Y(l,e,y);l=o.width,e=o.deltaW;const f=X(d,t,i);d=f.height,t=f.deltaH,r&&(e=t*r,l=d*r),g+=e/2*m(c)+t/2*w(c),h+=e/2*w(c)-t/2*m(c);break}case"bottom-right":{const o=Y(l,e,y);l=o.width,e=o.deltaW;const f=X(d,t,i);d=f.height,t=f.deltaH,r&&(e=t*r,l=d*r),g+=e/2*m(c)-t/2*w(c),h+=e/2*w(c)+t/2*m(c);break}case"bottom":{const o=X(d,t,i);d=o.height,t=o.deltaH,r?(e=t*r,l=d*r,g+=e/2*m(c)-t/2*w(c),h+=e/2*w(c)+t/2*m(c)):(g-=t/2*w(c),h+=t/2*m(c));break}case"bottom-left":{e=-e;const o=Y(l,e,y);l=o.width,e=o.deltaW;const f=X(d,t,i);d=f.height,t=f.deltaH,r&&(d=l/r,t=e/r),g-=e/2*m(c)+t/2*w(c),h-=e/2*w(c)-t/2*m(c);break}case"left":{e=-e;const o=Y(l,e,y);l=o.width,e=o.deltaW,r?(d=l/r,t=e/r,g-=e/2*m(c)+t/2*w(c),h-=e/2*w(c)-t/2*m(c)):(g-=e/2*m(c),h-=e/2*w(c));break}case"top-left":{e=-e,t=-t;const o=Y(l,e,y);l=o.width,e=o.deltaW;const f=X(d,t,i);d=f.height,t=f.deltaH,r&&(l=d*r,e=t*r),g-=e/2*m(c)-t/2*w(c),h-=e/2*w(c)+t/2*m(c);break}case"top":{t=-t;const o=X(d,t,i);d=o.height,t=o.deltaH,r?(l=d*r,e=t*r,g+=e/2*m(c)+t/2*w(c),h+=e/2*w(c)-t/2*m(c)):(g+=t/2*w(c),h-=t/2*m(c));break}}return{position:{centerX:g,centerY:h},size:{width:l*p,height:d*u}}},X=(n,a,e)=>{const t=n+a;return t>e?n=t:(a=e-n,n=e),{height:n,deltaH:a}},Y=(n,a,e)=>{const t=n+a;return t>e?n=t:(a=e-n,n=e),{width:n,deltaW:a}},O=({centerX:n,centerY:a,width:e,height:t,angle:r})=>({top:a-t/2,left:n-e/2,width:e,height:t,angle:r}),j=(n,a,e)=>{const{width:t,height:r}=n;return{width:Math.abs(t),height:Math.abs(r),left:a-Math.abs(t)/2,top:e-Math.abs(r)/2}};let ne=1e3;function oe(n,a,e){const t=s.ref(),r=s.ref(!1),y=s.ref(!1),i=s.ref({width:a.width,height:a.height,left:a.left,top:a.top,angle:a.angle});function l(g){if(a.disabled)return;r.value=!0,y.value=!0;const h=n.value;let{clientX:c,clientY:p}=g;const{width:u,height:o,left:f,top:D}=i.value;h.style.zIndex=q();let v=0,z=0,C=0,B=0;if(a.boundary){const M=(h.parentElement||document.body).getBoundingClientRect();z=M.width-u,B=M.height-o}const P=c-f,_=p-D;e&&e("drag-start",i.value),S(E=>{let M=E.clientX-P,k=E.clientY-_;a.boundary&&(M=M<v?v:M,M=M>z?z:M,k=k<C?C:k,k=k>B?B:k),i.value.left=M,i.value.top=k,e&&e("drag",i.value)},E=>{r.value=!1,document.addEventListener("click",d,{once:!0}),e&&e("drag-end",i.value)})}const d=()=>{y.value=!1};return s.onMounted(()=>{n.value&&n.value.addEventListener("mousedown",l)}),{isMousedown:r,selected:y,dragRef:t,dragData:i}}function q(){return++ne+""}function S(n,a){const e=t=>{a&&a(t),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",e)}const se=Object.keys(R).reduce((n,a)=>(n[a]=R[a].default,n),{}),re={mounted(n,a){const e={...se,...a.value||{}};n.classList.add("es-drager"),n.onmousedown=t=>{const r=t.clientX,y=t.clientY,i=n.getBoundingClientRect();n.style.zIndex=q();let l=0,d=0,g=0,h=0;if(e.boundary){const o=(n.parentElement||document.body).getBoundingClientRect();l=o.left,d=o.left+o.width-i.width,g=o.top,h=o.top+o.height-i.height}const c=r-i.left,p=y-i.top;S(u=>{let o=u.clientX-c,f=u.clientY-p;e.boundary&&(o=o<l?l:o,o=o>d?d:o,f=f<g?g:f,f=f>h?h:f),n.style.left=o+"px",n.style.top=f+"px"})}},unmounted(n){n.onmousedown=null}},ce=[s.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[s.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})],-1)],ae=s.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(n,{emit:a}){const e=n,t=s.ref(null),r=s.computed({get:()=>e.modelValue,set:i=>{a("update:modelValue",i)}});function y(i){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");i.stopPropagation(),i.preventDefault();const{width:l,height:d,left:g,top:h}=e.element.getBoundingClientRect(),c=g+l/2,p=h+d/2;a("rotate-start",r.value),S(u=>{const o=c-u.clientX,f=p-u.clientY,v=Math.atan2(f,o)*180/Math.PI-90;r.value=(v+360)%360,a("rotate",r.value)},()=>{a("rotate-end",r.value)})}return(i,l)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:y},ce,544))}}),De="",ie={key:0},le=["data-side","onMousedown"],T=s.defineComponent({__name:"drager",props:R,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(n,{emit:a}){const e=n,t=(p,...u)=>{a(p,...u),a("change",...u)},r=s.ref(null),{selected:y,dragData:i,isMousedown:l}=oe(r,e,t),d=s.ref(I()),g=s.computed(()=>{const{width:p,height:u,left:o,top:f,angle:D}=i.value;return{width:A(p),height:A(u),left:A(o),top:A(f),transform:`rotate(${D}deg)`,"--es-drager-color":e.color}});function h(p){d.value=I(p),t("rotate-end",i.value)}function c(p,u){u.stopPropagation(),u.preventDefault();const o=u.clientX,f=u.clientY,{width:D,height:v,left:z,top:C}=i.value,B=z+D/2,P=C+v/2,_={width:D,height:v,centerX:B,centerY:P,rotateAngle:i.value.angle},U=p.side,{minWidth:E,minHeight:M,aspectRatio:k}=e;t("resize-start",i.value),S(K=>{const{clientX:de,clientY:ue}=K,Z=de-o,G=ue-f,fe=Math.atan2(G,Z),J=x(Z,G),he=K.shiftKey,Q=fe-N(_.rotateAngle),ge=J*Math.cos(Q),pe=J*Math.sin(Q),me=he&&!k?_.width/_.height:k,{position:{centerX:H,centerY:W},size:{width:we,height:ye}}=F(U,{..._,rotateAngle:_.rotateAngle},ge,pe,me,E,M),be=O({centerX:H,centerY:W,width:we,height:ye,angle:i.value.angle});i.value={...i.value,...j(be,H,W)},t("resize",i.value)},()=>{t("resize-end",i.value)})}return s.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([p,u,o,f,D])=>{i.value={...i.value,width:p,height:u,left:o,top:f,angle:D}}),(p,u)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"dragRef",ref:r,class:s.normalizeClass(["es-drager",{disabled:p.disabled,dragging:s.unref(l)}]),style:s.normalizeStyle(s.unref(g)),onClick:u[3]||(u[3]=s.withModifiers(()=>{},["stop"]))},[s.renderSlot(p.$slots,"default"),!p.disabled&&p.resizable?s.withDirectives((s.openBlock(),s.createElementBlock("div",ie,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(d.value,(o,f)=>(s.openBlock(),s.createElementBlock("div",{key:f,class:"es-drager-dot","data-side":o.side,style:s.normalizeStyle({...o}),onMousedown:D=>c(o,D)},null,44,le))),128))],512)),[[s.vShow,s.unref(y)]]):s.createCommentVNode("",!0),!p.disabled&&s.unref(y)?(s.openBlock(),s.createBlock(ae,{key:1,modelValue:s.unref(i).angle,"onUpdate:modelValue":u[0]||(u[0]=o=>s.unref(i).angle=o),"drag-data":s.unref(i),element:r.value,onRotate:u[1]||(u[1]=o=>t("rotate",s.unref(i))),onRotateStart:u[2]||(u[2]=o=>t("rotate-start",s.unref(i))),onRotateEnd:h},null,8,["modelValue","drag-data","element"])):s.createCommentVNode("",!0)],6))}}),ke="";T.install=n=>{n.component("es-drager",T)},b.Drager=re,b.DragerProps=R,b.centerToTL=O,b.cursorDirectionArray=L,b.default=T,b.degToRadian=N,b.formatData=j,b.getCursor=$,b.getDotList=I,b.getLength=x,b.getNewStyle=F,b.resizableMap=V,b.withUnit=A,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
