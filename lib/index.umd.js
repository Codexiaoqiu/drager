(function(w,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(w=typeof globalThis<"u"?globalThis:w||self,s(w.ESDrager={},w.Vue))})(this,function(w,s){"use strict";const K={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean},v=(r=0)=>parseInt(r+"")+"px",I={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},_=["n","ne","e","se","s","sw","w","nw"],ne={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},oe={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},U=(r,o)=>{const e=oe[Math.floor(r/30)],c=(ne[o]+e)%8;return _[c]},P=(r=0)=>{let o=[];for(let e=0;e<_.length;e++){const t=_[e],[c,p]=I[t].split("-"),i=U(r,t),u={[c]:"0%",cursor:i+"-resize",side:I[t]};if(p)u[p]="0%";else{const f=["top","bottom"].includes(c)?"left":"top";u[f]="50%"}o[e]=u}return o},N=r=>r*Math.PI/180,F=(r,o)=>Math.sqrt(r*r+o*o),m=r=>Math.cos(N(r)),y=r=>Math.sin(N(r)),j=(r,o,e,t,c,p,i)=>{let{width:u,height:f,centerX:b,centerY:M,rotateAngle:a}=o;const h=u<0?-1:1,l=f<0?-1:1;switch(u=Math.abs(u),f=Math.abs(f),r){case"right":{const n=R(u,e,p);u=n.width,e=n.deltaW,c?(t=e/c,f=u/c,b+=e/2*m(a)-t/2*y(a),M+=e/2*y(a)+t/2*m(a)):(b+=e/2*m(a),M+=e/2*y(a));break}case"top-right":{t=-t;const n=R(u,e,p);u=n.width,e=n.deltaW;const d=E(f,t,i);f=d.height,t=d.deltaH,c&&(e=t*c,u=f*c),b+=e/2*m(a)+t/2*y(a),M+=e/2*y(a)-t/2*m(a);break}case"bottom-right":{const n=R(u,e,p);u=n.width,e=n.deltaW;const d=E(f,t,i);f=d.height,t=d.deltaH,c&&(e=t*c,u=f*c),b+=e/2*m(a)-t/2*y(a),M+=e/2*y(a)+t/2*m(a);break}case"bottom":{const n=E(f,t,i);f=n.height,t=n.deltaH,c?(e=t*c,u=f*c,b+=e/2*m(a)-t/2*y(a),M+=e/2*y(a)+t/2*m(a)):(b-=t/2*y(a),M+=t/2*m(a));break}case"bottom-left":{e=-e;const n=R(u,e,p);u=n.width,e=n.deltaW;const d=E(f,t,i);f=d.height,t=d.deltaH,c&&(f=u/c,t=e/c),b-=e/2*m(a)+t/2*y(a),M-=e/2*y(a)-t/2*m(a);break}case"left":{e=-e;const n=R(u,e,p);u=n.width,e=n.deltaW,c?(f=u/c,t=e/c,b-=e/2*m(a)+t/2*y(a),M-=e/2*y(a)-t/2*m(a)):(b-=e/2*m(a),M-=e/2*y(a));break}case"top-left":{e=-e,t=-t;const n=R(u,e,p);u=n.width,e=n.deltaW;const d=E(f,t,i);f=d.height,t=d.deltaH,c&&(u=f*c,e=t*c),b-=e/2*m(a)-t/2*y(a),M-=e/2*y(a)+t/2*m(a);break}case"top":{t=-t;const n=E(f,t,i);f=n.height,t=n.deltaH,c?(u=f*c,e=t*c,b+=e/2*m(a)+t/2*y(a),M+=e/2*y(a)-t/2*m(a)):(b+=t/2*y(a),M-=t/2*m(a));break}}return{position:{centerX:b,centerY:M},size:{width:u*h,height:f*l}}},E=(r,o,e)=>{const t=r+o;return t>e?r=t:(o=e-r,r=e),{height:r,deltaH:o}},R=(r,o,e)=>{const t=r+o;return t>e?r=t:(o=e-r,r=e),{width:r,deltaW:o}},q=({centerX:r,centerY:o,width:e,height:t,angle:c})=>({top:o-t/2,left:r-e/2,width:e,height:t,angle:c}),O=(r,o,e)=>{const{width:t,height:c}=r;return{width:Math.abs(t),height:Math.abs(c),left:o-Math.abs(t)/2,top:e-Math.abs(c)/2}};let se=1e3;function re(r,o,e){const t=s.ref(),c=s.ref(!1),p=s.ref(!1),i=s.ref({width:o.width,height:o.height,left:o.left,top:o.top,angle:o.angle});function u(h){if(o.disabled)return;c.value=!0,p.value=!0;const l=r.value;let{clientX:n,clientY:d}=h;const{left:g,top:k}=i.value;l.style.zIndex=ae();let z=0,Y=0;o.boundary&&([z,Y]=f()),e&&e("drag-start",i.value),$(B=>{let A=(B.clientX-n)/o.scaleRatio+g,D=(B.clientY-d)/o.scaleRatio+k;if(o.snapToGrid){let{left:L,top:S}=i.value;const G=A-L,T=D-S;A=x(G,o.gridX,L),D=x(T,o.gridY,S)}o.boundary&&([A,D]=b(A,D,z,Y)),i.value.left=A,i.value.top=D,e&&e("drag",i.value)},B=>{c.value=!1,document.addEventListener("click",M,{once:!0}),e&&e("drag-end",i.value)})}const f=()=>{const{width:h,height:l}=i.value,d=(r.value.parentElement||document.body).getBoundingClientRect(),g=d.width/o.scaleRatio-h,k=d.height/o.scaleRatio-l;return[g,k]},b=(h,l,n,d)=>(h=h<0?0:h,h=h>n?n:h,l=l<0?0:l,l=l>d?d:l,[h,l]),M=()=>{p.value=!1},a=h=>{if(c.value)return;let{left:l,top:n}=i.value;if(["ArrowRight","ArrowLeft"].includes(h.key)){const d=h.key==="ArrowRight";let g=d?1:-1;o.snapToGrid&&(g=d?o.gridX:-o.gridX),l=l+g}else if(["ArrowUp","ArrowDown"].includes(h.key)){const d=h.key==="ArrowDown";let g=d?1:-1;o.snapToGrid&&(g=d?o.gridY:-o.gridY),n=n+g}if(o.boundary){const[d,g]=f();[l,n]=b(l,n,d,g)}i.value.left=l,i.value.top=n};return s.onMounted(()=>{r.value&&r.value.addEventListener("mousedown",u)}),s.watch(p,h=>{o.disabledKeyEvent||(h?document.addEventListener("keydown",a):document.removeEventListener("keydown",a))}),s.onBeforeUnmount(()=>{document.removeEventListener("keydown",a)}),{isMousedown:c,selected:p,dragRef:t,dragData:i}}function ae(){return++se+""}function $(r,o){const e=t=>{o&&o(t),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",e)}function x(r,o,e){let t=e;return Math.abs(r)>o/2&&(t=e+(r>0?o:-o)),t}const ce=s.createElementVNode("div",{class:"es-drager-rotate-handle"},[s.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[s.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),le=s.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(r,{emit:o}){const e=r,t=s.ref(null),c=s.computed({get:()=>e.modelValue,set:i=>{o("update:modelValue",i)}});function p(i){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");i.stopPropagation(),i.preventDefault();const{width:u,height:f,left:b,top:M}=e.element.getBoundingClientRect(),a=b+u/2,h=M+f/2;o("rotate-start",c.value),$(l=>{const n=a-l.clientX,d=h-l.clientY,k=Math.atan2(d,n)*180/Math.PI-90;c.value=(k+360)%360,o("rotate",c.value)},()=>{o("rotate-end",c.value)})}return(i,u)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:p},[s.renderSlot(i.$slots,"default",{},()=>[ce])],544))}}),ke="",ie=["data-side","onMousedown"],de=s.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),X=s.defineComponent({__name:"drager",props:K,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(r,{emit:o}){const e=r,t=(l,...n)=>{o(l,...n),o("change",...n)},c=s.ref(null),{selected:p,dragData:i,isMousedown:u}=re(c,e,t),f=s.ref(P()),b=s.computed(()=>{const{width:l,height:n,left:d,top:g,angle:k}=i.value;return{width:v(l),height:v(n),left:v(d),top:v(g),transform:`rotate(${k}deg)`,"--es-drager-color":e.color}});function M(l){f.value=P(l),t("rotate-end",i.value)}function a(l,n){const d=Math.abs(l)%n,g=l>0?n:-n;let k=0;return d>n/2?k=g*Math.ceil(Math.abs(l)/n):k=g*Math.floor(Math.abs(l)/n),k}function h(l,n){n.stopPropagation(),n.preventDefault();const d=n.clientX,g=n.clientY,{width:k,height:z,left:Y,top:J}=i.value,B=Y+k/2,A=J+z/2,D={width:k,height:z,centerX:B,centerY:A,rotateAngle:i.value.angle},L=l.side,{minWidth:S,minHeight:G,aspectRatio:T}=e;t("resize-start",i.value),$(Q=>{const{clientX:ue,clientY:fe}=Q;let V=(ue-d)/e.scaleRatio,C=(fe-g)/e.scaleRatio;e.snapToGrid&&(V=a(V,e.gridX),C=a(C,e.gridY));const he=Math.atan2(C,V),H=F(V,C),ge=Q.shiftKey,W=he-N(D.rotateAngle),we=H*Math.cos(W),me=H*Math.sin(W),ye=ge&&!T?D.width/D.height:T,{position:{centerX:ee,centerY:te},size:{width:pe,height:be}}=j(L,{...D,rotateAngle:D.rotateAngle},we,me,ye,S,G),Me=q({centerX:ee,centerY:te,width:pe,height:be,angle:i.value.angle});i.value={...i.value,...O(Me,ee,te)},t("resize",i.value)},()=>{t("resize-end",i.value)})}return s.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([l,n,d,g,k])=>{i.value={...i.value,width:l,height:n,left:d,top:g,angle:k}}),s.watch(()=>e.selected,l=>{p.value=l},{immediate:!0}),(l,n)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"dragRef",ref:c,class:s.normalizeClass(["es-drager",{disabled:l.disabled,dragging:s.unref(u),selected:s.unref(p)}]),style:s.normalizeStyle(s.unref(b)),onClick:n[3]||(n[3]=s.withModifiers(()=>{},["stop"]))},[s.renderSlot(l.$slots,"default"),!l.disabled&&l.resizable?(s.openBlock(!0),s.createElementBlock(s.Fragment,{key:0},s.renderList(f.value,(d,g)=>(s.openBlock(),s.createElementBlock("div",{key:g,class:"es-drager-dot","data-side":d.side,style:s.normalizeStyle({...d}),onMousedown:k=>h(d,k)},[s.renderSlot(l.$slots,"resize",s.normalizeProps(s.guardReactiveProps({side:d.side})),()=>[de])],44,ie))),128)):s.createCommentVNode("",!0),!l.disabled&&s.unref(p)?(s.openBlock(),s.createBlock(le,{key:1,modelValue:s.unref(i).angle,"onUpdate:modelValue":n[0]||(n[0]=d=>s.unref(i).angle=d),"drag-data":s.unref(i),element:c.value,onRotate:n[1]||(n[1]=d=>t("rotate",s.unref(i))),onRotateStart:n[2]||(n[2]=d=>t("rotate-start",s.unref(i))),onRotateEnd:M},{default:s.withCtx(()=>[s.renderSlot(l.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):s.createCommentVNode("",!0)],6))}}),De="",Z=r=>{r.component("es-drager",X)};X.install=Z,w.DragerProps=K,w.ESDrager=X,w.centerToTL=q,w.cursorDirectionArray=_,w.default=X,w.degToRadian=N,w.formatData=O,w.getCursor=U,w.getDotList=P,w.getLength=F,w.getNewStyle=j,w.install=Z,w.resizableMap=I,w.withUnit=v,Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
