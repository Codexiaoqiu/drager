(function(h,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(h=typeof globalThis<"u"?globalThis:h||self,n(h.ESDrager={},h.Vue))})(this,function(h,n){"use strict";const F={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1}},A=(r=0)=>parseInt(r+"")+"px",P={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},_=["n","ne","e","se","s","sw","w","nw"],oe={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},se={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},j=(r,s)=>{const e=se[Math.floor(r/30)],a=(oe[s]+e)%8;return _[a]},$=(r=0)=>{let s=[];for(let e=0;e<_.length;e++){const t=_[e],[a,w]=P[t].split("-"),l=j(r,t),i={[a]:"0%",cursor:l+"-resize",side:P[t]};if(w)i[w]="0%";else{const d=["top","bottom"].includes(a)?"left":"top";i[d]="50%"}s[e]=i}return s},N=r=>r*Math.PI/180,q=(r,s)=>Math.sqrt(r*r+s*s),g=r=>Math.cos(N(r)),m=r=>Math.sin(N(r)),O=(r,s,e,t,a,w,l)=>{let{width:i,height:d,centerX:b,centerY:p,rotateAngle:c}=s;const R=i<0?-1:1,f=d<0?-1:1;switch(i=Math.abs(i),d=Math.abs(d),r){case"right":{const o=z(i,e,w);i=o.width,e=o.deltaW,a?(t=e/a,d=i/a,b+=e/2*g(c)-t/2*m(c),p+=e/2*m(c)+t/2*g(c)):(b+=e/2*g(c),p+=e/2*m(c));break}case"top-right":{t=-t;const o=z(i,e,w);i=o.width,e=o.deltaW;const u=v(d,t,l);d=u.height,t=u.deltaH,a&&(e=t*a,i=d*a),b+=e/2*g(c)+t/2*m(c),p+=e/2*m(c)-t/2*g(c);break}case"bottom-right":{const o=z(i,e,w);i=o.width,e=o.deltaW;const u=v(d,t,l);d=u.height,t=u.deltaH,a&&(e=t*a,i=d*a),b+=e/2*g(c)-t/2*m(c),p+=e/2*m(c)+t/2*g(c);break}case"bottom":{const o=v(d,t,l);d=o.height,t=o.deltaH,a?(e=t*a,i=d*a,b+=e/2*g(c)-t/2*m(c),p+=e/2*m(c)+t/2*g(c)):(b-=t/2*m(c),p+=t/2*g(c));break}case"bottom-left":{e=-e;const o=z(i,e,w);i=o.width,e=o.deltaW;const u=v(d,t,l);d=u.height,t=u.deltaH,a&&(d=i/a,t=e/a),b-=e/2*g(c)+t/2*m(c),p-=e/2*m(c)-t/2*g(c);break}case"left":{e=-e;const o=z(i,e,w);i=o.width,e=o.deltaW,a?(d=i/a,t=e/a,b-=e/2*g(c)+t/2*m(c),p-=e/2*m(c)-t/2*g(c)):(b-=e/2*g(c),p-=e/2*m(c));break}case"top-left":{e=-e,t=-t;const o=z(i,e,w);i=o.width,e=o.deltaW;const u=v(d,t,l);d=u.height,t=u.deltaH,a&&(i=d*a,e=t*a),b-=e/2*g(c)-t/2*m(c),p-=e/2*m(c)+t/2*g(c);break}case"top":{t=-t;const o=v(d,t,l);d=o.height,t=o.deltaH,a?(i=d*a,e=t*a,b+=e/2*g(c)+t/2*m(c),p+=e/2*m(c)-t/2*g(c)):(b+=t/2*m(c),p-=t/2*g(c));break}}return{position:{centerX:b,centerY:p},size:{width:i*R,height:d*f}}},v=(r,s,e)=>{const t=r+s;return t>e?r=t:(s=e-r,r=e),{height:r,deltaH:s}},z=(r,s,e)=>{const t=r+s;return t>e?r=t:(s=e-r,r=e),{width:r,deltaW:s}},U=({centerX:r,centerY:s,width:e,height:t,angle:a})=>({top:s-t/2,left:r-e/2,width:e,height:t,angle:a}),K=(r,s,e)=>{const{width:t,height:a}=r;return{width:Math.abs(t),height:Math.abs(a),left:s-Math.abs(t)/2,top:e-Math.abs(a)/2}};let re=1e3;function ae(r,s,e){const t=n.ref(),a=n.ref(!1),w=n.ref(!1),l=n.ref({width:s.width,height:s.height,left:s.left,top:s.top,angle:s.angle});function i(b){if(s.disabled)return;a.value=!0,w.value=!0;const p=r.value;let{clientX:c,clientY:R}=b;const{width:f,height:o,left:u,top:D}=l.value;p.style.zIndex=ce();let M=0,X=0,S=0,E=0;if(s.boundary){const y=(p.parentElement||document.body).getBoundingClientRect();X=y.width/s.scaleRatio-f,E=y.height/s.scaleRatio-o}e&&e("drag-start",l.value),G(Y=>{let y=(Y.clientX-c)/s.scaleRatio+u,k=(Y.clientY-R)/s.scaleRatio+D;if(s.snapToGrid){let{left:L,top:V}=l.value;const T=y-L,x=k-V;y=Z(T,s.gridX,L),k=Z(x,s.gridY,V)}s.boundary&&(y=y<M?M:y,y=y>X?X:y,k=k<S?S:k,k=k>E?E:k),l.value.left=y,l.value.top=k,e&&e("drag",l.value)},Y=>{a.value=!1,document.addEventListener("click",d,{once:!0}),e&&e("drag-end",l.value)})}const d=()=>{w.value=!1};return n.onMounted(()=>{r.value&&r.value.addEventListener("mousedown",i)}),{isMousedown:a,selected:w,dragRef:t,dragData:l}}function ce(){return++re+""}function G(r,s){const e=t=>{s&&s(t),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",e)}function Z(r,s,e){let t=e;return Math.abs(r)>s/2&&(t=e+(r>0?s:-s)),t}const le=n.createElementVNode("div",{class:"es-drager-rotate-handle"},[n.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[n.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),ie=n.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(r,{emit:s}){const e=r,t=n.ref(null),a=n.computed({get:()=>e.modelValue,set:l=>{s("update:modelValue",l)}});function w(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation(),l.preventDefault();const{width:i,height:d,left:b,top:p}=e.element.getBoundingClientRect(),c=b+i/2,R=p+d/2;s("rotate-start",a.value),G(f=>{const o=c-f.clientX,u=R-f.clientY,M=Math.atan2(u,o)*180/Math.PI-90;a.value=(M+360)%360,s("rotate",a.value)},()=>{s("rotate-end",a.value)})}return(l,i)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:w},[n.renderSlot(l.$slots,"default",{},()=>[le])],544))}}),ke="",de=["data-side","onMousedown"],ue=n.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),B=n.defineComponent({__name:"drager",props:F,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(r,{emit:s}){const e=r,t=(f,...o)=>{s(f,...o),s("change",...o)},a=n.ref(null),{selected:w,dragData:l,isMousedown:i}=ae(a,e,t),d=n.ref($()),b=n.computed(()=>{const{width:f,height:o,left:u,top:D,angle:M}=l.value;return{width:A(f),height:A(o),left:A(u),top:A(D),transform:`rotate(${M}deg)`,"--es-drager-color":e.color}});function p(f){d.value=$(f),t("rotate-end",l.value)}function c(f,o){const u=Math.abs(f)%o,D=f>0?o:-o;let M=0;return u>o/2?M=D*Math.ceil(Math.abs(f)/o):M=D*Math.floor(Math.abs(f)/o),M}function R(f,o){o.stopPropagation(),o.preventDefault();const u=o.clientX,D=o.clientY,{width:M,height:X,left:S,top:E}=l.value,Q=S+M/2,Y=E+X/2,y={width:M,height:X,centerX:Q,centerY:Y,rotateAngle:l.value.angle},k=f.side,{minWidth:L,minHeight:V,aspectRatio:T}=e;t("resize-start",l.value),G(H=>{const{clientX:fe,clientY:he}=H;let C=(fe-u)/e.scaleRatio,I=(he-D)/e.scaleRatio;e.snapToGrid&&(C=c(C,e.gridX),I=c(I,e.gridY));const ge=Math.atan2(I,C),W=q(C,I),me=H.shiftKey,ee=ge-N(y.rotateAngle),pe=W*Math.cos(ee),we=W*Math.sin(ee),be=me&&!T?y.width/y.height:T,{position:{centerX:te,centerY:ne},size:{width:ye,height:Me}}=O(k,{...y,rotateAngle:y.rotateAngle},pe,we,be,L,V),De=U({centerX:te,centerY:ne,width:ye,height:Me,angle:l.value.angle});l.value={...l.value,...K(De,te,ne)},t("resize",l.value)},()=>{t("resize-end",l.value)})}return n.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([f,o,u,D,M])=>{l.value={...l.value,width:f,height:o,left:u,top:D,angle:M}}),n.watch(()=>e.selected,f=>{w.value=f},{immediate:!0}),(f,o)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"dragRef",ref:a,class:n.normalizeClass(["es-drager",{disabled:f.disabled,dragging:n.unref(i),selected:n.unref(w)}]),style:n.normalizeStyle(n.unref(b)),onClick:o[3]||(o[3]=n.withModifiers(()=>{},["self","stop"]))},[n.renderSlot(f.$slots,"default"),!f.disabled&&f.resizable?(n.openBlock(!0),n.createElementBlock(n.Fragment,{key:0},n.renderList(d.value,(u,D)=>(n.openBlock(),n.createElementBlock("div",{key:D,class:"es-drager-dot","data-side":u.side,style:n.normalizeStyle({...u}),onMousedown:M=>R(u,M)},[n.renderSlot(f.$slots,"resize",n.normalizeProps(n.guardReactiveProps({side:u.side})),()=>[ue])],44,de))),128)):n.createCommentVNode("",!0),!f.disabled&&n.unref(w)?(n.openBlock(),n.createBlock(ie,{key:1,modelValue:n.unref(l).angle,"onUpdate:modelValue":o[0]||(o[0]=u=>n.unref(l).angle=u),"drag-data":n.unref(l),element:a.value,onRotate:o[1]||(o[1]=u=>t("rotate",n.unref(l))),onRotateStart:o[2]||(o[2]=u=>t("rotate-start",n.unref(l))),onRotateEnd:p},{default:n.withCtx(()=>[n.renderSlot(f.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):n.createCommentVNode("",!0)],6))}}),Re="",J=r=>{r.component("es-drager",B)};B.install=J,h.DragerProps=F,h.ESDrager=B,h.centerToTL=U,h.cursorDirectionArray=_,h.default=B,h.degToRadian=N,h.formatData=K,h.getCursor=j,h.getDotList=$,h.getLength=q,h.getNewStyle=O,h.install=J,h.resizableMap=P,h.withUnit=A,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
