(function(k,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(k=typeof globalThis<"u"?globalThis:k||self,o(k.ESDrager={},k.Vue))})(this,function(k,o){"use strict";const Z={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean},B=(a=0)=>parseInt(a+"")+"px",$={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},x=["n","ne","e","se","s","sw","w","nw"],J={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Q={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},H=(a,n)=>{const e=Q[Math.floor(a/30)],s=(J[n]+e)%8;return x[s]},P=(a=0)=>{let n=[];for(let e=0;e<x.length;e++){const t=x[e],[s,p]=$[t].split("-"),i=H(a,t),f={[s]:"0%",cursor:i+"-resize",side:$[t]};if(p)f[p]="0%";else{const h=["top","bottom"].includes(s)?"left":"top";f[h]="50%"}n[e]=f}return n},T=a=>a*Math.PI/180,W=(a,n)=>Math.sqrt(a*a+n*n),w=a=>Math.cos(T(a)),m=a=>Math.sin(T(a)),ee=(a,n,e,t,s,p,i)=>{let{width:f,height:h,centerX:y,centerY:b,rotateAngle:c}=n;const d=f<0?-1:1,l=h<0?-1:1;switch(f=Math.abs(f),h=Math.abs(h),a){case"right":{const r=A(f,e,p);f=r.width,e=r.deltaW,s?(t=e/s,h=f/s,y+=e/2*w(c)-t/2*m(c),b+=e/2*m(c)+t/2*w(c)):(y+=e/2*w(c),b+=e/2*m(c));break}case"top-right":{t=-t;const r=A(f,e,p);f=r.width,e=r.deltaW;const u=v(h,t,i);h=u.height,t=u.deltaH,s&&(e=t*s,f=h*s),y+=e/2*w(c)+t/2*m(c),b+=e/2*m(c)-t/2*w(c);break}case"bottom-right":{const r=A(f,e,p);f=r.width,e=r.deltaW;const u=v(h,t,i);h=u.height,t=u.deltaH,s&&(e=t*s,f=h*s),y+=e/2*w(c)-t/2*m(c),b+=e/2*m(c)+t/2*w(c);break}case"bottom":{const r=v(h,t,i);h=r.height,t=r.deltaH,s?(e=t*s,f=h*s,y+=e/2*w(c)-t/2*m(c),b+=e/2*m(c)+t/2*w(c)):(y-=t/2*m(c),b+=t/2*w(c));break}case"bottom-left":{e=-e;const r=A(f,e,p);f=r.width,e=r.deltaW;const u=v(h,t,i);h=u.height,t=u.deltaH,s&&(h=f/s,t=e/s),y-=e/2*w(c)+t/2*m(c),b-=e/2*m(c)-t/2*w(c);break}case"left":{e=-e;const r=A(f,e,p);f=r.width,e=r.deltaW,s?(h=f/s,t=e/s,y-=e/2*w(c)+t/2*m(c),b-=e/2*m(c)-t/2*w(c)):(y-=e/2*w(c),b-=e/2*m(c));break}case"top-left":{e=-e,t=-t;const r=A(f,e,p);f=r.width,e=r.deltaW;const u=v(h,t,i);h=u.height,t=u.deltaH,s&&(f=h*s,e=t*s),y-=e/2*w(c)-t/2*m(c),b-=e/2*m(c)+t/2*w(c);break}case"top":{t=-t;const r=v(h,t,i);h=r.height,t=r.deltaH,s?(f=h*s,e=t*s,y+=e/2*w(c)+t/2*m(c),b+=e/2*m(c)-t/2*w(c)):(y+=t/2*m(c),b-=t/2*w(c));break}}return{position:{centerX:y,centerY:b},size:{width:f*d,height:h*l}}},v=(a,n,e)=>{const t=a+n;return t>e?a=t:(n=e-a,a=e),{height:a,deltaH:n}},A=(a,n,e)=>{const t=a+n;return t>e?a=t:(n=e-a,a=e),{width:a,deltaW:n}},te=({centerX:a,centerY:n,width:e,height:t,angle:s})=>({top:n-t/2,left:a-e/2,width:e,height:t,angle:s}),ne=(a,n,e)=>{const{width:t,height:s}=a;return{width:Math.abs(t),height:Math.abs(s),left:n-Math.abs(t)/2,top:e-Math.abs(s)/2}};function z(a,n){const e=Math.abs(a)%n,t=a>0?n:-n;let s=0;return e>n/2?s=t*Math.ceil(Math.abs(a)/n):s=t*Math.floor(Math.abs(a)/n),s}let oe=1e3;function se(a,n,e){const t=o.ref(),s=o.ref(!1),p=o.ref(!1),i=o.ref({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle});function f(d){if(n.disabled)return;s.value=!0,p.value=!0;let{clientX:l,clientY:r}=d;const{left:u,top:g}=i.value;a.value.style.zIndex=re();let D=0,X=0;n.boundary&&([D,X]=h()),e&&e("drag-start",i.value),C(R=>{let E=(R.clientX-l)/n.scaleRatio+u,M=(R.clientY-r)/n.scaleRatio+g;if(n.snapToGrid){let{left:Y,top:N}=i.value;const I=E-Y,L=M-N;E=Y+z(I,n.gridX),M=N+z(L,n.gridY)}n.boundary&&([E,M]=y(E,M,D,X)),i.value.left=E,i.value.top=M,e&&e("drag",i.value)},R=>{s.value=!1,document.addEventListener("click",b,{once:!0}),e&&e("drag-end",i.value)})}const h=()=>{const{width:d,height:l}=i.value,u=(a.value.parentElement||document.body).getBoundingClientRect(),g=u.width/n.scaleRatio-d,D=u.height/n.scaleRatio-l;return[g,D]},y=(d,l,r,u)=>(d=d<0?0:d,d=d>r?r:d,l=l<0?0:l,l=l>u?u:l,[d,l]),b=()=>{p.value=!1},c=d=>{if(s.value)return;let{left:l,top:r}=i.value;if(["ArrowRight","ArrowLeft"].includes(d.key)){const u=d.key==="ArrowRight";let g=u?1:-1;n.snapToGrid&&(g=u?n.gridX:-n.gridX),l=l+g}else if(["ArrowUp","ArrowDown"].includes(d.key)){const u=d.key==="ArrowDown";let g=u?1:-1;n.snapToGrid&&(g=u?n.gridY:-n.gridY),r=r+g}if(n.boundary){const[u,g]=h();[l,r]=y(l,r,u,g)}i.value.left=l,i.value.top=r};return o.onMounted(()=>{a.value&&a.value.addEventListener("mousedown",f)}),o.watch(p,d=>{n.disabledKeyEvent||(d?document.addEventListener("keydown",c):document.removeEventListener("keydown",c))}),o.onBeforeUnmount(()=>{document.removeEventListener("keydown",c)}),{isMousedown:s,selected:p,dragRef:t,dragData:i}}function re(){return++oe+""}function C(a,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e)}const ae=o.createElementVNode("div",{class:"es-drager-rotate-handle"},[o.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[o.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),ce=o.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(a,{emit:n}){const e=a,t=o.ref(null),s=o.computed({get:()=>e.modelValue,set:i=>{n("update:modelValue",i)}});function p(i){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");i.stopPropagation(),i.preventDefault();const{width:f,height:h,left:y,top:b}=e.element.getBoundingClientRect(),c=y+f/2,d=b+h/2;n("rotate-start",s.value),C(l=>{const r=c-l.clientX,u=d-l.clientY,D=Math.atan2(u,r)*180/Math.PI-90;s.value=(D+360)%360,n("rotate",s.value)},()=>{n("rotate-end",s.value)})}return(i,f)=>(o.openBlock(),o.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:p},[o.renderSlot(i.$slots,"default",{},()=>[ae])],544))}}),Me="",ie=["data-side","onMousedown"],le=o.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),_=o.defineComponent({__name:"drager",props:Z,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(a,{emit:n}){const e=a,t=(d,...l)=>{n(d,...l),n("change",...l)},s=o.ref(null),{selected:p,dragData:i,isMousedown:f}=se(s,e,t),h=o.ref(P()),y=o.computed(()=>{const{width:d,height:l,left:r,top:u,angle:g}=i.value;return{width:B(d),height:B(l),left:B(r),top:B(u),transform:`rotate(${g}deg)`,"--es-drager-color":e.color}});function b(d){h.value=P(d),t("rotate-end",i.value)}function c(d,l){l.stopPropagation(),l.preventDefault();const r=l.clientX,u=l.clientY,{width:g,height:D,left:X,top:K}=i.value,R=X+g/2,E=K+D/2,M={width:g,height:D,centerX:R,centerY:E,rotateAngle:i.value.angle},Y=d.side,{minWidth:N,minHeight:I,aspectRatio:L}=e;t("resize-start",i.value),C(F=>{const{clientX:de,clientY:ue}=F;let S=(de-r)/e.scaleRatio,V=(ue-u)/e.scaleRatio;e.snapToGrid&&(S=z(S,e.gridX),V=z(V,e.gridY));const fe=Math.atan2(V,S),U=W(S,V),he=F.shiftKey,j=fe-T(M.rotateAngle),ge=U*Math.cos(j),we=U*Math.sin(j),me=he&&!L?M.width/M.height:L,{position:{centerX:q,centerY:O},size:{width:pe,height:ye}}=ee(Y,{...M,rotateAngle:M.rotateAngle},ge,we,me,N,I),be=te({centerX:q,centerY:O,width:pe,height:ye,angle:i.value.angle});i.value={...i.value,...ne(be,q,O)},t("resize",i.value)},()=>{t("resize-end",i.value)})}return o.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([d,l,r,u,g])=>{i.value={...i.value,width:d,height:l,left:r,top:u,angle:g}}),o.watch(()=>e.selected,d=>{p.value=d},{immediate:!0}),(d,l)=>(o.openBlock(),o.createElementBlock("div",{ref_key:"dragRef",ref:s,class:o.normalizeClass(["es-drager",{disabled:d.disabled,dragging:o.unref(f),selected:o.unref(p)}]),style:o.normalizeStyle(o.unref(y)),onClick:l[3]||(l[3]=o.withModifiers(()=>{},["stop"]))},[o.renderSlot(d.$slots,"default"),!d.disabled&&d.resizable?(o.openBlock(!0),o.createElementBlock(o.Fragment,{key:0},o.renderList(h.value,(r,u)=>(o.openBlock(),o.createElementBlock("div",{key:u,class:"es-drager-dot","data-side":r.side,style:o.normalizeStyle({...r}),onMousedown:o.withModifiers(g=>c(r,g),["stop","prevent"])},[o.renderSlot(d.$slots,"resize",o.normalizeProps(o.guardReactiveProps({side:r.side})),()=>[le])],44,ie))),128)):o.createCommentVNode("",!0),!d.disabled&&o.unref(p)?(o.openBlock(),o.createBlock(ce,{key:1,modelValue:o.unref(i).angle,"onUpdate:modelValue":l[0]||(l[0]=r=>o.unref(i).angle=r),"drag-data":o.unref(i),element:s.value,onRotate:l[1]||(l[1]=r=>t("rotate",o.unref(i))),onRotateStart:l[2]||(l[2]=r=>t("rotate-start",o.unref(i))),onRotateEnd:b},{default:o.withCtx(()=>[o.renderSlot(d.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):o.createCommentVNode("",!0)],6))}}),ke="",G=a=>{a.component("es-drager",_)};_.install=G,k.ESDrager=_,k.default=_,k.install=G,Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
