(function(D,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(D=typeof globalThis<"u"?globalThis:D||self,s(D.ESDrager={},D.Vue))})(this,function(D,s){"use strict";const ne={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function G(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function S(o){let n=0,e=0;if(oe(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function oe(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const N=(o=0)=>parseInt(o+"")+"px",j={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},K=["n","ne","e","se","s","sw","w","nw"],se={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},re={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},ae=(o,n)=>{const e=re[Math.floor(o/30)],r=(se[n]+e)%8;return K[r]},U=(o=0,n)=>{let e=[];for(let t=0;t<K.length;t++){const r=K[t],[h,l]=j[r].split("-"),g=ae(o,r),d={[h]:"0%",cursor:g+"-resize",side:j[r]};if(l)d[l]="0%";else{const w=["top","bottom"].includes(h)?"left":"top";d[w]="50%"}n?n.includes(j[r])&&e.push(d):e.push(d)}return e},O=o=>o*Math.PI/180,ie=(o,n)=>Math.sqrt(o*o+n*n),y=o=>Math.cos(O(o)),b=o=>Math.sin(O(o)),ce=(o,n,e,t,r,h,l)=>{let{width:g,height:d,centerX:w,centerY:v,rotateAngle:i}=n;const B=g<0?-1:1,p=d<0?-1:1;switch(g=Math.abs(g),d=Math.abs(d),o){case"right":{const a=C(g,e,h);g=a.width,e=a.deltaW,r?(t=e/r,d=g/r,w+=e/2*y(i)-t/2*b(i),v+=e/2*b(i)+t/2*y(i)):(w+=e/2*y(i),v+=e/2*b(i));break}case"top-right":{t=-t;const a=C(g,e,h);g=a.width,e=a.deltaW;const f=R(d,t,l);d=f.height,t=f.deltaH,r&&(e=t*r,g=d*r),w+=e/2*y(i)+t/2*b(i),v+=e/2*b(i)-t/2*y(i);break}case"bottom-right":{const a=C(g,e,h);g=a.width,e=a.deltaW;const f=R(d,t,l);d=f.height,t=f.deltaH,r&&(e=t*r,g=d*r),w+=e/2*y(i)-t/2*b(i),v+=e/2*b(i)+t/2*y(i);break}case"bottom":{const a=R(d,t,l);d=a.height,t=a.deltaH,r?(e=t*r,g=d*r,w+=e/2*y(i)-t/2*b(i),v+=e/2*b(i)+t/2*y(i)):(w-=t/2*b(i),v+=t/2*y(i));break}case"bottom-left":{e=-e;const a=C(g,e,h);g=a.width,e=a.deltaW;const f=R(d,t,l);d=f.height,t=f.deltaH,r&&(d=g/r,t=e/r),w-=e/2*y(i)+t/2*b(i),v-=e/2*b(i)-t/2*y(i);break}case"left":{e=-e;const a=C(g,e,h);g=a.width,e=a.deltaW,r?(d=g/r,t=e/r,w-=e/2*y(i)+t/2*b(i),v-=e/2*b(i)-t/2*y(i)):(w-=e/2*y(i),v-=e/2*b(i));break}case"top-left":{e=-e,t=-t;const a=C(g,e,h);g=a.width,e=a.deltaW;const f=R(d,t,l);d=f.height,t=f.deltaH,r&&(g=d*r,e=t*r),w-=e/2*y(i)-t/2*b(i),v-=e/2*b(i)+t/2*y(i);break}case"top":{t=-t;const a=R(d,t,l);d=a.height,t=a.deltaH,r?(g=d*r,e=t*r,w+=e/2*y(i)+t/2*b(i),v+=e/2*b(i)-t/2*y(i)):(w+=t/2*b(i),v-=t/2*y(i));break}}return{position:{centerX:w,centerY:v},size:{width:g*B,height:d*p}}},R=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},C=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},le=({centerX:o,centerY:n,width:e,height:t,angle:r})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:r}),ue=(o,n,e)=>{const{width:t,height:r}=o;return{width:Math.abs(t),height:Math.abs(r),left:n-Math.abs(t)/2,top:e-Math.abs(r)/2}};function T(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let r=0;return e>n/2?r=t*Math.ceil(Math.abs(o)/n):r=t*Math.floor(Math.abs(o)/n),r}function de(o,n){if(!o||!n)return!1;const e=o.getBoundingClientRect(),t=n.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function he(o,n,e){const t=s.ref(!1),r=s.ref(!1),h=s.ref({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),l=new Set;function g(p){if(l.add(p.button),n.disabled)return;t.value=!0,r.value=!0;let{clientX:a,clientY:f}=S(p);const{left:c,top:u}=h.value;let m=0,M=0,k=0,E=0;n.boundary&&([m,M,k,E]=d()),e&&e("drag-start",h.value),G(A=>{if(l.size>1)return;const{clientX:L,clientY:V}=S(A);let Y=(L-a)/n.scaleRatio+c,z=(V-f)/n.scaleRatio+u;if(n.snapToGrid){let{left:X,top:P}=h.value;const q=Y-X,F=z-P;Y=X+T(q,n.gridX),z=P+T(F,n.gridY)}n.boundary&&([Y,z]=w(Y,z,m,M,k,E)),h.value.left=Y,h.value.top=z,e&&e("drag",h.value)},A=>{n.checkCollision&&v()&&(h.value.top=u,h.value.left=c),l.clear(),t.value=!1,document.addEventListener("click",i,{once:!0}),e&&e("drag-end",h.value)})}const d=()=>{let p=0,a=0;const{left:f,top:c,height:u,width:m,angle:M}=h.value,E=(o.value.parentElement||document.body).getBoundingClientRect();if(M&&n.scaleRatio===1){const L=o.value.getBoundingClientRect();p=Math.abs(L.left-(f+E.left)),a=Math.abs(L.top-(c+E.top))}const _=E.width/n.scaleRatio-m,A=E.height/n.scaleRatio-u;return[p,_-p,a,A-a]},w=(p,a,f,c,u,m)=>(p=p<f?f:p,p=p>c?c:p,a=a<u?u:a,a=a>m?m:a,[p,a]),v=()=>{const p=o.value.parentElement||document.body,a=Array.from(p.children).filter(f=>f!==o.value&&f.classList.contains("es-drager"));for(let f=0;f<a.length;f++){const c=a[f];if(de(o.value,c))return!0}},i=()=>{r.value=!1},B=p=>{if(t.value)return;let{left:a,top:f}=h.value;if(["ArrowRight","ArrowLeft"].includes(p.key)){const c=p.key==="ArrowRight";let u=c?1:-1;n.snapToGrid&&(u=c?n.gridX:-n.gridX),a=a+u}else if(["ArrowUp","ArrowDown"].includes(p.key)){const c=p.key==="ArrowDown";let u=c?1:-1;n.snapToGrid&&(u=c?n.gridY:-n.gridY),f=f+u}if(n.boundary){const[c,u,m,M]=d();[a,f]=w(a,f,c,u,m,M)}h.value.left=a,h.value.top=f};return s.onMounted(()=>{if(o.value){if(!h.value.width&&!h.value.height){const{width:p,height:a}=o.value.getBoundingClientRect();h.value={...h.value,width:p||100,height:a||100},e("change",{...h.value})}o.value.addEventListener("mousedown",g),o.value.addEventListener("touchstart",g,{passive:!0})}}),s.watch(r,p=>{n.disabledKeyEvent||(p?document.addEventListener("keydown",B):document.removeEventListener("keydown",B))}),s.onBeforeUnmount(()=>{document.removeEventListener("keydown",B)}),{isMousedown:t,selected:r,dragData:h,getBoundary:d,checkDragerCollision:v}}const fe=s.createElementVNode("div",{class:"es-drager-rotate-handle"},[s.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[s.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),ge=s.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=s.ref(null),r=s.computed({get:()=>e.modelValue,set:l=>{n("update:modelValue",l)}});function h(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation();const{width:g,height:d,left:w,top:v}=e.element.getBoundingClientRect(),i=w+g/2,B=v+d/2;n("rotate-start",r.value),G(p=>{const{clientX:a,clientY:f}=S(p),c=i-a,u=B-f,M=Math.atan2(u,c)*180/Math.PI-90;r.value=(M+360)%360,n("rotate",r.value)},()=>{n("rotate-end",r.value)})}return(l,g)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:h,onTouchstartPassive:h},[s.renderSlot(l.$slots,"default",{},()=>[fe])],544))}}),Xe="",pe=["data-side","onMousedown","onTouchstartPassive"],me=s.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),x=s.defineComponent({__name:"drager",props:ne,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(c,...u)=>{n(c,...u),n("change",...u)},r=s.ref(null),{selected:h,dragData:l,isMousedown:g,checkDragerCollision:d}=he(r,e,t),w=s.ref(U(0,e.resizeList)),v=s.computed(()=>e.resizable&&!e.disabled),i=s.computed(()=>e.rotatable&&!e.disabled&&h.value),B=s.computed(()=>{const{width:c,height:u,left:m,top:M,angle:k}=l.value,E={};return c&&(E.width=N(c)),u&&(E.height=N(u)),{...E,left:N(m),top:N(M),zIndex:e.zIndex,transform:`rotate(${k}deg)`,"--es-drager-color":e.color}});function p(c){r.value||(r.value=c.$el||c)}function a(c){w.value=U(c,e.resizeList),t("rotate-end",l.value)}function f(c,u){u.stopPropagation();const{clientX:m,clientY:M}=S(u),k=m,E=M,{width:_,height:A,left:L,top:V}=l.value,Y=L+_/2,z=V+A/2,X={width:_,height:A,centerX:Y,centerY:z,rotateAngle:l.value.angle},P=c.side,{minWidth:q,minHeight:F,aspectRatio:Q,equalProportion:we}=e;t("resize-start",l.value),G(Z=>{const{clientX:ye,clientY:be}=S(Z);let $=(ye-k)/e.scaleRatio,I=(be-E)/e.scaleRatio;e.snapToGrid&&($=T($,e.gridX),I=T(I,e.gridY));const ve=Math.atan2(I,$),H=ie($,I),Me=Z.shiftKey,W=ve-O(X.rotateAngle),ke=H*Math.cos(W),Ee=H*Math.sin(W),De=(we||Me)&&!Q?X.width/X.height:Q,{position:{centerX:ee,centerY:te},size:{width:Be,height:Ae}}=ce(P,{...X,rotateAngle:X.rotateAngle},ke,Ee,De,q,F),Le=le({centerX:ee,centerY:te,width:Be,height:Ae,angle:l.value.angle});l.value={...l.value,...ue(Le,ee,te)},t("resize",l.value)},()=>{e.checkCollision&&d()&&(l.value={...l.value,width:_,height:A,left:L,top:V}),t("resize-end",l.value)})}return s.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([c,u,m,M,k])=>{l.value={...l.value,width:c,height:u,left:m,top:M,angle:k}}),s.watch(()=>e.selected,c=>{h.value=c},{immediate:!0}),(c,u)=>(s.openBlock(),s.createBlock(s.resolveDynamicComponent(c.tag),{ref:p,class:s.normalizeClass(["es-drager",{disabled:c.disabled,dragging:s.unref(g),selected:s.unref(h),border:c.border}]),style:s.normalizeStyle(B.value),onClick:u[3]||(u[3]=s.withModifiers(()=>{},["stop"]))},{default:s.withCtx(()=>[s.renderSlot(c.$slots,"default"),v.value?(s.openBlock(!0),s.createElementBlock(s.Fragment,{key:0},s.renderList(w.value,(m,M)=>(s.openBlock(),s.createElementBlock("div",{key:M,class:"es-drager-dot","data-side":m.side,style:s.normalizeStyle({...m}),onMousedown:k=>f(m,k),onTouchstartPassive:k=>f(m,k)},[s.renderSlot(c.$slots,"resize",s.normalizeProps(s.guardReactiveProps({side:m.side})),()=>[me])],44,pe))),128)):s.createCommentVNode("",!0),i.value?(s.openBlock(),s.createBlock(ge,{key:1,modelValue:s.unref(l).angle,"onUpdate:modelValue":u[0]||(u[0]=m=>s.unref(l).angle=m),element:r.value,onRotate:u[1]||(u[1]=m=>t("rotate",s.unref(l))),onRotateStart:u[2]||(u[2]=m=>t("rotate-start",s.unref(l))),onRotateEnd:a},{default:s.withCtx(()=>[s.renderSlot(c.$slots,"rotate")]),_:3},8,["modelValue","element"])):s.createCommentVNode("",!0)]),_:3},8,["class","style"]))}}),Ye="",J=o=>{o.component("es-drager",x)};x.install=J,D.ESDrager=x,D.default=x,D.install=J,Object.defineProperties(D,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
